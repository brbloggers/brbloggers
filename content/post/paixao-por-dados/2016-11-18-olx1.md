+++
title = "Como usar o R para escolher um lugar para morar(1) - Web Scraping e Data Cleaning"
date = "2016-11-18 03:00:00"
categories = ["paixao-por-dados"]
+++

<article class="blog-post">
<p>
Imagine-se na seguinte situação: você foi convidado a se mudar para a
cidade do Rio de Janeiro a trabalho e precisa procurar um lugar para
morar. Pessoas normais resolveriam esse problema pesquisando preços de
apartamentos ou quartos para alugar em sites como OLX ou AirBNB. Mas
como alguém fascinado em programação e análise resolveria?
</p>
<p>
Nesta série de posts, mostro como o R pode ser usado tomar a decisão
sobre escolher um apartamento ou quarto para alugar. No OLX, a
formatação HTML das páginas de apartamentos são diferentes das de
quartos. Neste post, eu mostro como fazer o web scraping, por meio do
pacote <code class="highlighter-rouge">rvest</code>, apenas de
apartamentos, mas o mesmo procedimento (com pequenas modificações) pode
ser feito também para quartos.
</p>
<p>
As bibliotecas usadas serão:
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="n">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span><span class="w"> </span><span class="c1"># n&#xE3;o vivo sem esse pacote
</span><span class="n">library</span><span class="p">(</span><span class="n">rvest</span><span class="p">)</span><span class="w"> </span><span class="c1"># principal pacote para web-scraping
</span><span class="n">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span><span class="w"> </span><span class="c1"># usado para extrair numeros de texto
</span><span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span><span class="w"> </span><span class="c1"># usado para o data cleaning
</span><span class="n">library</span><span class="p">(</span><span class="n">curl</span><span class="p">)</span><span class="w"> </span><span class="c1"># usado como suporte para o rvest
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w"> </span><span class="c1"># data cleaning
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w"> </span><span class="c1"># data cleaning
</span><span class="n">devtools</span><span class="o">::</span><span class="n">source_gist</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;aed28301b7088e47326feac136ceface&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;funcoes olx.R&quot;</span><span class="p">)</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">algumas</span><span class="w"> </span><span class="n">funcoes</span><span class="w"> </span><span class="n">que</span><span class="w"> </span><span class="n">criei</span><span class="w"> </span><span class="n">para</span><span class="w"> </span><span class="n">auxiliar</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">cleaning</span></code></pre>
</figure>
<h2 id="web-scraping">
Web scraping
</h2>
<p>
A primeira etapa é obter os dados. Até a data de hoje (12 de Novembro de
2016), o
<a href="http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/aluguel/apartamentos">OLX</a>
listava um pouco mais de 12000 apartamentos para alugar, com 245 páginas
e 50 apartamentos em cada página.
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="n">url_apt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">&quot;http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/aluguel/apartamentos&quot;</span><span class="w">
</span><span class="n">number_pages</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">245</span><span class="w"> </span><span class="c1">#hard coded
# Criar vetor com todos os urls para as p&#xE1;ginas do olx
</span><span class="n">lista_urls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">url_apt</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;?o=&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">number_pages</span><span class="p">)</span></code></pre>
</figure>
<p>
A seguir, eu uso uma função para extrair as informações importantes de
cada anúncio, que são: o link para o anúncio, o título, o preço, o
bairro e mais algumas informações adicionais, como número de vagas de
garagem e o valor da taxa de condomínio. Explicar o passo-a-passo do web
scraping e explicar como o código fonte das páginas do OLX funciona está
fora do escopo deste post, mas acredito que basta ler o código da função
extrairAnuncios() para entender o que o script faz. Caso o leitor deseje
saber mais sobre web scraping, o post 3 da série traz um tutorial de web
scraping bem detalhado.
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="n">extrairAnuncios</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">url_pagina</span><span class="p">,</span><span class="w"> </span><span class="n">info_adicional</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">### INPUTS:
</span><span class="w"> </span><span class="c1"># url_pagina: url de uma pagina do olx com uma lista de links de an&#xFA;ncios.
</span><span class="w"> </span><span class="c1"># info_adicional: variavel booleana. se verdadeiro, faz o scraping de dados adicionais do anuncio
</span><span class="w"> </span><span class="c1"># ... deve ser usado apenas para apartamentos, pois a sintaxe do html para quartos &#xE9; diferente
</span><span class="w"> </span><span class="n">mycurl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">curl</span><span class="p">(</span><span class="n">url_pagina</span><span class="p">,</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curl</span><span class="o">::</span><span class="n">new_handle</span><span class="p">(</span><span class="s2">&quot;useragent&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Mozilla/5.0&quot;</span><span class="p">))</span><span class="w"> </span><span class="n">mycurl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_html</span><span class="p">(</span><span class="n">mycurl</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mycurl</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_nodes</span><span class="p">(</span><span class="s2">&quot;.OLXad-list-link&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1"># extrair link do anuncio
</span><span class="w"> </span><span class="n">col_links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mycurl</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_nodes</span><span class="p">(</span><span class="s2">&quot;.OLXad-list-link&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1"># extrair titulo do anuncio
</span><span class="w"> </span><span class="n">col_titles</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mycurl</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_nodes</span><span class="p">(</span><span class="s2">&quot;.OLXad-list-link&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_attr</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1"># extrair pre&#xE7;o
</span><span class="w"> </span><span class="n">precos</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_nodes</span><span class="p">(</span><span class="s2">&quot;.col-3&quot;</span><span class="p">))</span><span class="w"> </span><span class="n">precos</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">html_text</span><span class="p">)</span><span class="w"> </span><span class="n">precos</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">unlist</span><span class="p">()</span><span class="w"> </span><span class="n">precos</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">limparString</span><span class="p">()</span><span class="w"> </span><span class="n">precos</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">()</span><span class="w"> </span><span class="n">col_precos</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">precos</span><span class="w"> </span><span class="c1"># extrair bairros
</span><span class="w"> </span><span class="n">bairros</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mycurl</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_nodes</span><span class="p">(</span><span class="s2">&quot;.OLXad-list-line-2&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_text</span><span class="p">()</span><span class="w"> </span><span class="n">bairros</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">str_replace_all</span><span class="p">(</span><span class="s2">&quot;[\t]&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">bairros</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">str_replace_all</span><span class="p">(</span><span class="s2">&quot;[\n]&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">bairros</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">str_replace_all</span><span class="p">(</span><span class="s2">&quot;Apartamentos&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">bairros</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">str_replace_all</span><span class="p">(</span><span class="s2">&quot;Aluguel de quartos&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">bairros</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">str_replace_all</span><span class="p">(</span><span class="s2">&quot;An&#xFA;ncio Profissional&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">bairros</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">str_replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">bairros</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">str_trim</span><span class="p">()</span><span class="w"> </span><span class="n">col_bairros</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">bairros</span><span class="w"> </span><span class="c1"># extrair informa&#xE7;&#xF5;es adicionais de apartamento
</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">info_adicional</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">adicional</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mycurl</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_nodes</span><span class="p">(</span><span class="s2">&quot;.mt5px&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_text</span><span class="p">()</span><span class="w"> </span><span class="n">adicional</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">str_replace_all</span><span class="p">(</span><span class="s2">&quot;[\t]&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">adicional</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">str_replace_all</span><span class="p">(</span><span class="s2">&quot;[\n]&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">col_adicionais</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">adicional</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="nf">return</span><span class="p">(</span><span class="n">data.frame</span><span class="p">(</span><span class="n">link</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col_links</span><span class="p">,</span><span class="w"> </span><span class="n">titulo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col_titles</span><span class="p">,</span><span class="w"> </span><span class="n">preco</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col_precos</span><span class="p">,</span><span class="w"> </span><span class="n">bairro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col_bairros</span><span class="p">,</span><span class="w"> </span><span class="n">adicional</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col_adicionais</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w">
</span><span class="p">}</span></code></pre>
</figure>
<p>
Agora já podemos aplicar a função
<code class="highlighter-rouge">extrairAnuncios()</code> no vetor da
lista de urls para baixar os dados. Para fins de demonstração, vou
executar o procedimento apenas para a primeira página.
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="n">url_teste</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lista_urls</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span><span class="n">system.time</span><span class="p">(</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">extrairAnuncios</span><span class="p">(</span><span class="n">url_teste</span><span class="p">,</span><span class="w"> </span><span class="n">info_adicional</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## user system elapsed ## 0.948 0.064 1.013</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># Vamos dar uma olhada nos dados
</span><span class="n">head</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">()</span></code></pre>
</figure>
<table>
<thead>
<tr>
<th>
link
</th>
<th>
titulo
</th>
<th>
preco
</th>
<th>
bairro
</th>
<th>
adicional
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/village-pavuna-270991833>
</td>
<td>
Village pavuna
</td>
<td>
400
</td>
<td>
Rio de Janeiro, Pavuna
</td>
<td>
1 quarto | 50 m² | Condomínio: R$ 250 | 1 vaga
</td>
</tr>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/excelente-apartamento-todo-reformado-na-freguesia-270535159>
</td>
<td>
Excelente apartamento todo reformado na Freguesia
</td>
<td>
1500
</td>
<td>
Rio de Janeiro, Freguesia
</td>
<td>
1 quarto | 42 m² | Condomínio: R$ 390 | 1 vaga
</td>
</tr>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/excelente-apartamento-270991747>
</td>
<td>
Excelente Apartamento
</td>
<td>
2000
</td>
<td>
Rio de Janeiro, Recreio Dos Bandeirantes
</td>
<td>
3 quartos | 82 m² | Condomínio: R$ 970 | 2 vagas
</td>
</tr>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/excelente-apartamento-270990414>
</td>
<td>
Excelente Apartamento
</td>
<td>
1900
</td>
<td>
Rio de Janeiro, Recreio Dos Bandeirantes
</td>
<td>
2 quartos | 80 m² | Condomínio: R$ 300 | 2 vagas
</td>
</tr>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/barra-da-tijuca-cidade-jardim-empreendimento-reserva-do-parque-com-area-util-de-114-m-270988871>
</td>
<td>
Barra da Tijuca - Cidade Jardim, Empreendimento Reserva do Parque, com
área útil de 114 m
</td>
<td>
3500
</td>
<td>
Rio de Janeiro, Jacarepaguá
</td>
<td>
3 quartos | 114 m² | Condomínio: R$ 1300 | 2 vagas
</td>
</tr>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/apartamento-copacabana-3-quartos-270989551>
</td>
<td>
Apartamento Copacabana, 3 quartos
</td>
<td>
3300
</td>
<td>
Rio de Janeiro, Copacabana
</td>
<td>
3 quartos | 98 m² | Condomínio: R$ 979
</td>
</tr>
</tbody>
</table>
<h2 id="data-cleaning">
Data Cleaning
</h2>
<p>
Pode-se ver que o web scraping (ao menos para esses 5 exemplos) foi bem
feito pois os os dados foram extraídos adequadamente. Contudo, é
evidente a necessidade de se limpar os dados para poder os analisar. A
coluna de informações adicionais, por exemplo, informa dados de até
quatro variáveis: quantidade de quartos, quantidade de vagas de garagem,
área e o preço da taxa de condomínio. Para deixar o processo de limpeza
ainda mais difícil, nem todos os anúncios fornecem dados dessas quatro
variáveis.
</p>
<p>
Antes de partir para esse problema, vamos separa a coluna de bairro em
duas: uma de cidade e outra de bairro. Removi os imóveis que não são do
Rio de Janeiro ou de Niterói para fins de simplicidade.
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># remover os que nao sao do RJ ou de niteroi
</span><span class="n">df</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">str_detect</span><span class="p">(</span><span class="n">bairro</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Niter&#xF3;i&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">str_detect</span><span class="p">(</span><span class="n">bairro</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Rio de Janeiro&quot;</span><span class="p">))</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">separate</span><span class="p">(</span><span class="n">bairro</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">&quot;cidade&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bairro&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">()</span></code></pre>
</figure>
<table>
<thead>
<tr>
<th>
link
</th>
<th>
titulo
</th>
<th>
preco
</th>
<th>
cidade
</th>
<th>
bairro
</th>
<th>
adicional
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/village-pavuna-270991833>
</td>
<td>
Village pavuna
</td>
<td>
400
</td>
<td>
Rio de Janeiro
</td>
<td>
Pavuna
</td>
<td>
1 quarto | 50 m² | Condomínio: R$ 250 | 1 vaga
</td>
</tr>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/excelente-apartamento-todo-reformado-na-freguesia-270535159>
</td>
<td>
Excelente apartamento todo reformado na Freguesia
</td>
<td>
1500
</td>
<td>
Rio de Janeiro
</td>
<td>
Freguesia
</td>
<td>
1 quarto | 42 m² | Condomínio: R$ 390 | 1 vaga
</td>
</tr>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/excelente-apartamento-270991747>
</td>
<td>
Excelente Apartamento
</td>
<td>
2000
</td>
<td>
Rio de Janeiro
</td>
<td>
Recreio Dos Bandeirantes
</td>
<td>
3 quartos | 82 m² | Condomínio: R$ 970 | 2 vagas
</td>
</tr>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/excelente-apartamento-270990414>
</td>
<td>
Excelente Apartamento
</td>
<td>
1900
</td>
<td>
Rio de Janeiro
</td>
<td>
Recreio Dos Bandeirantes
</td>
<td>
2 quartos | 80 m² | Condomínio: R$ 300 | 2 vagas
</td>
</tr>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/barra-da-tijuca-cidade-jardim-empreendimento-reserva-do-parque-com-area-util-de-114-m-270988871>
</td>
<td>
Barra da Tijuca - Cidade Jardim, Empreendimento Reserva do Parque, com
área útil de 114 m
</td>
<td>
3500
</td>
<td>
Rio de Janeiro
</td>
<td>
Jacarepaguá
</td>
<td>
3 quartos | 114 m² | Condomínio: R$ 1300 | 2 vagas
</td>
</tr>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/apartamento-copacabana-3-quartos-270989551>
</td>
<td>
Apartamento Copacabana, 3 quartos
</td>
<td>
3300
</td>
<td>
Rio de Janeiro
</td>
<td>
Copacabana
</td>
<td>
3 quartos | 98 m² | Condomínio: R$ 979
</td>
</tr>
</tbody>
</table>
<p>
Agora podemos partir para a limpeza da coluna de adicionais.
Primeiramente, vamos ver quantos anúncios possuem as quatro variáveis
adicionais:
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># substituir quartos por quarto
</span><span class="n">df</span><span class="o">$</span><span class="n">adicional</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">str_replace_all</span><span class="p">(</span><span class="s2">&quot;quartos&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;quarto&quot;</span><span class="p">)</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="w"> </span><span class="n">tem_quarto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str_detect</span><span class="p">(</span><span class="n">adicional</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;quarto&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">tem_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str_detect</span><span class="p">(</span><span class="n">adicional</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;m&#xB2;&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">tem_taxa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str_detect</span><span class="p">(</span><span class="n">adicional</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Condom&#xED;nio&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">tem_garagem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str_detect</span><span class="p">(</span><span class="n">adicional</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;vaga&quot;</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">apply</span><span class="p">(</span><span class="n">df</span><span class="p">[,</span><span class="w"> </span><span class="m">7</span><span class="o">:</span><span class="m">10</span><span class="p">],</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">),</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## tem_quarto tem_area tem_taxa tem_garagem ## 100 94 94 80</code></pre>
</figure>
<p>
Assim, 100% dos apartamentos (dessa amostra de 50 apartamentos) têm
informação sobre a quantidade de quartos, 94% sobre área, 94% informam a
taxa de condomínio e 80% têm vaga de garagem.
</p>
<p>
É necessário usar o pacote
<code class="highlighter-rouge">stringr</code> para observar a posição
dos termos que identificam a variável:
</p>
<ul>
<li>
O substring “quarto” indica a presença de informação sobre quantidade de
quartos;
</li>
<li>
O substring “Condomínio:
R$&\#x201D; indica a presen&\#xE7;a de informa&\#xE7;&\#xE3;o sobre taxa do condom&\#xED;nio;&lt;/li&gt; &lt;li&gt;O substring &\#x201C;m&\#xB2;&\#x201D; indica a presen&\#xE7;a de informa&\#xE7;&\#xE3;o sobre &\#xE1;rea;&lt;/li&gt; &lt;li&gt;O substring &\#x201C;vaga&\#x201D; indica a presen&\#xE7;a de informa&\#xE7;&\#xE3;o sobre vagas de garagem.&lt;/li&gt; &lt;/ul&gt; &lt;p&gt;O desafio aqui &\#xE9; criar colunas adicionais para cada uma dessas categorias de informa&\#xE7;&\#xE3;o adicional. A seguir, eu comento linha a linha o procedimento necess&\#xE1;rio para realizar essa tarefa, que &\#xE9; basicamente o mesmo para as vari&\#xE1;veis.&lt;/p&gt; &lt;figure class="highlight"&gt;&lt;pre&gt;&lt;code class="language-r"&gt;&lt;span class="c1"&gt;\# COLUNA DE QUANTIDADE DE QUARTOS \# Quarto: pegar posicao inicial e final do string quarto \# Localizar trecho dentro do string referente a quartos &lt;/span&gt;&lt;span class="n"&gt;matriz\_posicao&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;str\_locate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;$</span><span
class="n">adicional</span><span class="p">,</span><span class="w">
</span><span class="s2">"quarto"</span><span class="p">)</span><span
class="w"> </span><span class="c1">\# Voltar 2 posições no string para
pegar o número (ex: 2 quarto) </span><span
class="n">matriz\_posicao</span><span class="p">\[,</span><span
class="m">1</span><span class="p">\]</span><span class="w"> </span><span
class="o">&lt;-</span><span class="w"> </span><span
class="n">matriz\_posicao</span><span class="p">\[,</span><span
class="m">1</span><span class="p">\]</span><span class="w"> </span><span
class="o">-</span><span class="w"> </span><span class="m">2</span><span
class="w"> </span><span class="c1">\# extrair string com posições
iniciais e finais </span><span class="n">vetor\_quartos</span><span
class="w"> </span><span class="o">&lt;-</span><span class="w">
</span><span class="n">str\_sub</span><span class="p">(</span><span
class="n">df</span><span
class="o">$&lt;/span&gt;&lt;span class="n"&gt;adicional&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;matriz\_posicao&lt;/span&gt;&lt;span class="p"&gt;\[,&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;\],&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;matriz\_posicao&lt;/span&gt;&lt;span class="p"&gt;\[,&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;\])&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;\# extrair apenas n&\#xFA;mero (primeiro caractere do string) e converter para numeric &lt;/span&gt;&lt;span class="n"&gt;vetor\_quartos&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;str\_sub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vetor\_quartos&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vetor\_quartos&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&lt;&gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;as.numeric&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;\# adicionar ao data frame &lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;$</span><span
class="n">qtd\_quarto</span><span class="w"> </span><span
class="o">&lt;-</span><span class="w"> </span><span
class="n">vetor\_quartos</span><span class="w"> </span><span
class="c1">\# Condominio \# retirar cifrao pra ficar mais facil
</span><span class="n">df</span><span
class="o">$&lt;/span&gt;&lt;span class="n"&gt;adicional&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&lt;&gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;str\_replace\_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&quot;\\\\$"</span><span
class="p">,</span><span class="w"> </span><span
class="s2">"S"</span><span class="p">)</span><span class="w">
</span><span class="n">matriz\_posicao</span><span class="w">
</span><span class="o">&lt;-</span><span class="w"> </span><span
class="n">str\_locate</span><span class="p">(</span><span
class="n">df</span><span
class="o">$&lt;/span&gt;&lt;span class="n"&gt;adicional&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&quot;Condom&\#xED;nio: RS &quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;\# mover cinco posicoes para pegar algarismos ap&\#xF3;s o RS &lt;/span&gt;&lt;span class="n"&gt;vetor\_taxa&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;str\_sub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;$</span><span
class="n">adicional</span><span class="p">,</span><span class="w">
</span><span class="n">matriz\_posicao</span><span
class="p">\[,</span><span class="w"> </span><span
class="m">2</span><span class="p">\],</span><span class="w">
</span><span class="n">matriz\_posicao</span><span
class="p">\[,</span><span class="w"> </span><span
class="m">2</span><span class="p">\]</span><span class="w"> </span><span
class="o">+</span><span class="w"> </span><span class="m">4</span><span
class="p">)</span><span class="w"> </span><span class="c1">\# extrair
apenas numeros </span><span class="n">vetor\_taxa</span><span class="w">
</span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span
class="n">parse\_number</span><span class="p">()</span><span class="w">
</span><span class="c1">\# vendo se funcionou </span><span
class="n">data.frame</span><span class="p">(</span><span
class="n">df</span><span
class="o">$&lt;/span&gt;&lt;span class="n"&gt;adicional&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vetor\_taxa&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;head&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;figure class="highlight"&gt;&lt;pre&gt;&lt;code class="language-text"&gt;\#\# df.adicional vetor\_taxa \#\# 1 1 quarto | 50 m&\#xB2; | Condom&\#xED;nio: RS 250 | 1 vaga 250 \#\# 2 1 quarto | 42 m&\#xB2; | Condom&\#xED;nio: RS 390 | 1 vaga 390 \#\# 3 3 quarto | 82 m&\#xB2; | Condom&\#xED;nio: RS 970 | 2 vagas 970 \#\# 4 2 quarto | 80 m&\#xB2; | Condom&\#xED;nio: RS 300 | 2 vagas 300 \#\# 5 3 quarto | 114 m&\#xB2; | Condom&\#xED;nio: RS 1300 | 2 vagas 1300 \#\# 6 3 quarto | 98 m&\#xB2; | Condom&\#xED;nio: RS 979 979 \#\# 7 2 quarto | 70 m&\#xB2; | Condom&\#xED;nio: RS 990 | 1 vaga 990 \#\# 8 1 quarto | 60 m&\#xB2; | Condom&\#xED;nio: RS 1000 | 1 vaga 1000 \#\# 9 2 quarto | 84 m&\#xB2; | Condom&\#xED;nio: RS 923 | 1 vaga 923 \#\# 10 1 quarto | 50 m&\#xB2; | Condom&\#xED;nio: RS 250 | 1 vaga 250 \#\# 11 4 quarto | 290 m&\#xB2; | Condom&\#xED;nio: RS 1000 | 1 vaga 1000 \#\# 12 2 quarto | 60 m&\#xB2; | Condom&\#xED;nio: RS 501 501 \#\# 13 1 quarto NA \#\# 14 2 quarto | 80 m&\#xB2; | Condom&\#xED;nio: RS 0 0 \#\# 15 2 quarto | 96 m&\#xB2; | Condom&\#xED;nio: RS 1287 | 2 vagas 1287 \#\# 16 3 quarto | 130 m&\#xB2; | Condom&\#xED;nio: RS 1100 | 2 vagas 1100 \#\# 17 2 quarto | 70 m&\#xB2; | Condom&\#xED;nio: RS 700 | 1 vaga 700 \#\# 18 1 quarto | 26 m&\#xB2; | Condom&\#xED;nio: RS 0 0 \#\# 19 3 quarto | 115 m&\#xB2; | Condom&\#xED;nio: RS 653 | 2 vagas 653 \#\# 20 2 quarto NA&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;figure class="highlight"&gt;&lt;pre&gt;&lt;code class="language-r"&gt;&lt;span class="c1"&gt;\# Funcionou! Incorporar vetor ao data frame &lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;$</span><span
class="n">taxa\_condominio</span><span class="w"> </span><span
class="o">&lt;-</span><span class="w"> </span><span
class="n">vetor\_taxa</span><span class="w"> </span><span class="c1">\#
Área </span><span class="n">matriz\_posicao</span><span class="w">
</span><span class="o">&lt;-</span><span class="w"> </span><span
class="n">str\_locate</span><span class="p">(</span><span
class="n">df</span><span
class="o">$&lt;/span&gt;&lt;span class="n"&gt;adicional&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&quot; m&\#xB2;&quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;\# voltar quatro posi&\#xE7;&\#xF5;es &lt;/span&gt;&lt;span class="n"&gt;vetor\_area&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;str\_sub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;$</span><span
class="n">adicional</span><span class="p">,</span><span class="w">
</span><span class="n">matriz\_posicao</span><span
class="p">\[,</span><span
class="m">1</span><span class="p">\]</span><span class="w"> </span><span
class="o">-</span><span class="w"> </span><span class="m">4</span><span
class="p">,</span><span class="w"> </span><span
class="n">matriz\_posicao</span><span class="p">\[,</span><span
class="w"> </span><span
class="m">1</span><span class="p">\])</span><span class="w">
</span><span class="c1">\# converter para numerico </span><span
class="n">vetor\_area</span><span class="w"> </span><span
class="o">%&lt;&gt;%</span><span class="w"> </span><span
class="n">parse\_number</span><span class="p">()</span><span class="w">
</span><span class="c1">\# vendo se funcionou </span><span
class="n">data.frame</span><span class="p">(</span><span
class="n">df</span><span
class="o">$&lt;/span&gt;&lt;span class="n"&gt;adicional&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vetor\_area&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;head&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;figure class="highlight"&gt;&lt;pre&gt;&lt;code class="language-text"&gt;\#\# df.adicional vetor\_area \#\# 1 1 quarto | 50 m&\#xB2; | Condom&\#xED;nio: RS 250 | 1 vaga 50 \#\# 2 1 quarto | 42 m&\#xB2; | Condom&\#xED;nio: RS 390 | 1 vaga 42 \#\# 3 3 quarto | 82 m&\#xB2; | Condom&\#xED;nio: RS 970 | 2 vagas 82 \#\# 4 2 quarto | 80 m&\#xB2; | Condom&\#xED;nio: RS 300 | 2 vagas 80 \#\# 5 3 quarto | 114 m&\#xB2; | Condom&\#xED;nio: RS 1300 | 2 vagas 114 \#\# 6 3 quarto | 98 m&\#xB2; | Condom&\#xED;nio: RS 979 98 \#\# 7 2 quarto | 70 m&\#xB2; | Condom&\#xED;nio: RS 990 | 1 vaga 70 \#\# 8 1 quarto | 60 m&\#xB2; | Condom&\#xED;nio: RS 1000 | 1 vaga 60 \#\# 9 2 quarto | 84 m&\#xB2; | Condom&\#xED;nio: RS 923 | 1 vaga 84 \#\# 10 1 quarto | 50 m&\#xB2; | Condom&\#xED;nio: RS 250 | 1 vaga 50 \#\# 11 4 quarto | 290 m&\#xB2; | Condom&\#xED;nio: RS 1000 | 1 vaga 290 \#\# 12 2 quarto | 60 m&\#xB2; | Condom&\#xED;nio: RS 501 60 \#\# 13 1 quarto NA \#\# 14 2 quarto | 80 m&\#xB2; | Condom&\#xED;nio: RS 0 80 \#\# 15 2 quarto | 96 m&\#xB2; | Condom&\#xED;nio: RS 1287 | 2 vagas 96 \#\# 16 3 quarto | 130 m&\#xB2; | Condom&\#xED;nio: RS 1100 | 2 vagas 130 \#\# 17 2 quarto | 70 m&\#xB2; | Condom&\#xED;nio: RS 700 | 1 vaga 70 \#\# 18 1 quarto | 26 m&\#xB2; | Condom&\#xED;nio: RS 0 26 \#\# 19 3 quarto | 115 m&\#xB2; | Condom&\#xED;nio: RS 653 | 2 vagas 115 \#\# 20 2 quarto NA&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;figure class="highlight"&gt;&lt;pre&gt;&lt;code class="language-r"&gt;&lt;span class="c1"&gt;\# Funcionou! Incorporar ao data frame &lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;$</span><span
class="n">area\_condominio</span><span class="w"> </span><span
class="o">&lt;-</span><span class="w"> </span><span
class="n">vetor\_area</span><span class="w"> </span><span class="c1">\#
Garagem </span><span class="n">matriz\_posicao</span><span class="w">
</span><span class="o">&lt;-</span><span class="w"> </span><span
class="n">str\_locate</span><span class="p">(</span><span
class="n">df</span><span
class="o">$&lt;/span&gt;&lt;span class="n"&gt;adicional&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&quot; vaga&quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;\# voltar quatro posi&\#xE7;&\#xF5;es &lt;/span&gt;&lt;span class="n"&gt;vetor\_garagem&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;str\_sub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;$</span><span
class="n">adicional</span><span class="p">,</span><span class="w">
</span><span class="n">matriz\_posicao</span><span
class="p">\[,</span><span
class="m">1</span><span class="p">\]</span><span class="w"> </span><span
class="o">-</span><span class="w"> </span><span class="m">2</span><span
class="p">,</span><span class="w"> </span><span
class="n">matriz\_posicao</span><span class="p">\[,</span><span
class="w"> </span><span
class="m">1</span><span class="p">\])</span><span class="w">
</span><span class="c1">\# converter para numerico </span><span
class="n">vetor\_garagem</span><span class="w"> </span><span
class="o">%&lt;&gt;%</span><span class="w"> </span><span
class="n">readr</span><span class="o">::</span><span
class="n">parse\_number</span><span class="p">()</span><span class="w">
</span><span class="c1">\# vendo se funcionou </span><span
class="n">data.frame</span><span class="p">(</span><span
class="n">df</span><span
class="o">$&lt;/span&gt;&lt;span class="n"&gt;adicional&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vetor\_garagem&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;head&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;figure class="highlight"&gt;&lt;pre&gt;&lt;code class="language-text"&gt;\#\# df.adicional vetor\_garagem \#\# 1 1 quarto | 50 m&\#xB2; | Condom&\#xED;nio: RS 250 | 1 vaga 1 \#\# 2 1 quarto | 42 m&\#xB2; | Condom&\#xED;nio: RS 390 | 1 vaga 1 \#\# 3 3 quarto | 82 m&\#xB2; | Condom&\#xED;nio: RS 970 | 2 vagas 2 \#\# 4 2 quarto | 80 m&\#xB2; | Condom&\#xED;nio: RS 300 | 2 vagas 2 \#\# 5 3 quarto | 114 m&\#xB2; | Condom&\#xED;nio: RS 1300 | 2 vagas 2 \#\# 6 3 quarto | 98 m&\#xB2; | Condom&\#xED;nio: RS 979 NA \#\# 7 2 quarto | 70 m&\#xB2; | Condom&\#xED;nio: RS 990 | 1 vaga 1 \#\# 8 1 quarto | 60 m&\#xB2; | Condom&\#xED;nio: RS 1000 | 1 vaga 1 \#\# 9 2 quarto | 84 m&\#xB2; | Condom&\#xED;nio: RS 923 | 1 vaga 1 \#\# 10 1 quarto | 50 m&\#xB2; | Condom&\#xED;nio: RS 250 | 1 vaga 1 \#\# 11 4 quarto | 290 m&\#xB2; | Condom&\#xED;nio: RS 1000 | 1 vaga 1 \#\# 12 2 quarto | 60 m&\#xB2; | Condom&\#xED;nio: RS 501 NA \#\# 13 1 quarto NA \#\# 14 2 quarto | 80 m&\#xB2; | Condom&\#xED;nio: RS 0 NA \#\# 15 2 quarto | 96 m&\#xB2; | Condom&\#xED;nio: RS 1287 | 2 vagas 2 \#\# 16 3 quarto | 130 m&\#xB2; | Condom&\#xED;nio: RS 1100 | 2 vagas 2 \#\# 17 2 quarto | 70 m&\#xB2; | Condom&\#xED;nio: RS 700 | 1 vaga 1 \#\# 18 1 quarto | 26 m&\#xB2; | Condom&\#xED;nio: RS 0 NA \#\# 19 3 quarto | 115 m&\#xB2; | Condom&\#xED;nio: RS 653 | 2 vagas 2 \#\# 20 2 quarto NA&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt; &lt;figure class="highlight"&gt;&lt;pre&gt;&lt;code class="language-r"&gt;&lt;span class="c1"&gt;\# Funcionou! Incorporar ao data frame &lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;$</span><span
class="n">garagem</span><span class="w"> </span><span
class="o">&lt;-</span><span class="w"> </span><span
class="n">vetor\_garagem</span><span class="w"> </span><span
class="c1">\# Remover objetos desnecessários </span><span
class="n">rm</span><span class="p">(</span><span
class="n">matriz\_posicao</span><span class="p">,</span><span class="w">
</span><span class="n">vetor\_adicional</span><span
class="p">,</span><span class="w"> </span><span
class="n">vetor\_area</span><span class="p">,</span><span class="w">
</span><span class="n">vetor\_garagem</span><span
class="p">,</span><span class="w"> </span><span
class="n">vetor\_quartos</span><span class="p">,</span><span class="w">
</span><span class="n">vetor\_taxa</span><span class="p">)</span></code>
</pre>
</figure>
<p>
Vamos ver como ficou o data frame final
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="n">head</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">knitr</span><span class="o">::</span><span class="n">kable</span><span class="p">()</span></code></pre>
</figure>
<table>
<thead>
<tr>
<th>
link
</th>
<th>
titulo
</th>
<th>
preco
</th>
<th>
cidade
</th>
<th>
bairro
</th>
<th>
adicional
</th>
<th>
tem\_quarto
</th>
<th>
tem\_area
</th>
<th>
tem\_taxa
</th>
<th>
tem\_garagem
</th>
<th>
qtd\_quarto
</th>
<th>
taxa\_condominio
</th>
<th>
area\_condominio
</th>
<th>
garagem
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/village-pavuna-270991833>
</td>
<td>
Village pavuna
</td>
<td>
400
</td>
<td>
Rio de Janeiro
</td>
<td>
Pavuna
</td>
<td>
1 quarto | 50 m² | Condomínio: RS 250 | 1 vaga
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
1
</td>
<td>
250
</td>
<td>
50
</td>
<td>
1
</td>
</tr>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/excelente-apartamento-todo-reformado-na-freguesia-270535159>
</td>
<td>
Excelente apartamento todo reformado na Freguesia
</td>
<td>
1500
</td>
<td>
Rio de Janeiro
</td>
<td>
Freguesia
</td>
<td>
1 quarto | 42 m² | Condomínio: RS 390 | 1 vaga
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
1
</td>
<td>
390
</td>
<td>
42
</td>
<td>
1
</td>
</tr>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/excelente-apartamento-270991747>
</td>
<td>
Excelente Apartamento
</td>
<td>
2000
</td>
<td>
Rio de Janeiro
</td>
<td>
Recreio Dos Bandeirantes
</td>
<td>
3 quarto | 82 m² | Condomínio: RS 970 | 2 vagas
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
3
</td>
<td>
970
</td>
<td>
82
</td>
<td>
2
</td>
</tr>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/excelente-apartamento-270990414>
</td>
<td>
Excelente Apartamento
</td>
<td>
1900
</td>
<td>
Rio de Janeiro
</td>
<td>
Recreio Dos Bandeirantes
</td>
<td>
2 quarto | 80 m² | Condomínio: RS 300 | 2 vagas
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
2
</td>
<td>
300
</td>
<td>
80
</td>
<td>
2
</td>
</tr>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/barra-da-tijuca-cidade-jardim-empreendimento-reserva-do-parque-com-area-util-de-114-m-270988871>
</td>
<td>
Barra da Tijuca - Cidade Jardim, Empreendimento Reserva do Parque, com
área útil de 114 m
</td>
<td>
3500
</td>
<td>
Rio de Janeiro
</td>
<td>
Jacarepaguá
</td>
<td>
3 quarto | 114 m² | Condomínio: RS 1300 | 2 vagas
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
3
</td>
<td>
1300
</td>
<td>
114
</td>
<td>
2
</td>
</tr>
<tr>
<td>
<http://rj.olx.com.br/rio-de-janeiro-e-regiao/imoveis/apartamento-copacabana-3-quartos-270989551>
</td>
<td>
Apartamento Copacabana, 3 quartos
</td>
<td>
3300
</td>
<td>
Rio de Janeiro
</td>
<td>
Copacabana
</td>
<td>
3 quarto | 98 m² | Condomínio: RS 979
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
TRUE
</td>
<td>
FALSE
</td>
<td>
3
</td>
<td>
979
</td>
<td>
98
</td>
<td>
NA
</td>
</tr>
</tbody>
</table>
<h2 id="conclusão">
Conclusão
</h2>
<p>
No próximo post, analisaremos os dados obtidos aqui.
</p>
</article>

