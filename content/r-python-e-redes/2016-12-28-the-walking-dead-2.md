+++
title = "The Walking DEAD - Parte 2 - Simulando novos cenários"
date = "2016-12-28 02:00:00"
categories = ["r-python-e-redes"]
original_url = "http://neylsoncrepalde.github.io/2016-12-28-the-walking-dead-2/"
+++

<article class="blog-post">
<p>
Olá! Em nosso post anterior inspirado no artigo de Riebling e Schmitz
(2016) intitulado ZombieApocalypse: Modeling the social dynamics of
infection and rejection, apresentamos uma solução para a implementação
de um modelo de contágio ou modelo de difusão em rede simulando uma
infestação zumbi. Hoje, vamos continuar o mesmo trabalho mas agora vamos
simular mais dois cenários diferentes. Além disso, vamos investigar
também a dinâmica da rede ao longo do processo de contágio. Para isso
estamos usando a distro Anaconda do Python 3.5. No post anterior
apresento as bibliotecas que precisam ser instaladas. Vamos lá!
</p>
<p>
<img src="http://static.digg.com/images/30ee29eb8ddc46e98b037b840d4f836f_6405d50da9fc4d3e84237c2be1ce7e30_header.jpeg" alt="">
</p>
<h2 id="carregando-bibliotecas">
Carregando bibliotecas
</h2>
<pre class="highlight"><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="kn">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">nxsim</span> <span class="kn">import</span> <span class="n">NetworkSimulation</span><span class="p">,</span> <span class="n">BaseNetworkAgent</span><span class="p">,</span> <span class="n">BaseLoggingAgent</span> <span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s">&apos;notebook&apos;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s">&apos;/home/neylson/diffusion_model&apos;</span><span class="p">)</span>
</code></pre>

<h2 id="algumas-funções-úteis">
Algumas funções úteis
</h2>
<pre class="highlight"><code><span class="k">def</span> <span class="nf">census_to_df</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">num_trials</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">state_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s">&apos;sim_01&apos;</span><span class="p">):</span> <span class="s">&quot;&quot;&quot;Reads nxsim log files and returns the sum of agents with a given state_id at every time interval of the simulation for every run of the simulation as a pandas DataFrame object.&quot;&quot;&quot;</span> <span class="n">D</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_trials</span><span class="p">):</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&apos;Trial &apos;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="n">trial</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">open_trial_state_history</span><span class="p">(</span><span class="n">dir_path</span><span class="o">=</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">trial_id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="n">census</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">node_id</span> <span class="o">!=</span> <span class="s">&apos;topology&apos;</span> <span class="ow">and</span> <span class="n">state</span><span class="p">[</span><span class="s">&apos;id&apos;</span><span class="p">]</span> <span class="o">==</span> <span class="n">state_id</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">trial</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span> <span class="n">D</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">census</span> <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="k">def</span> <span class="nf">friends_to_the_end</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">num_trials</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s">&apos;sim_01&apos;</span><span class="p">):</span> <span class="s">&quot;&quot;&quot;Reads nxsim log files and returns the number of human friends connected to every human at every time interval of the simulation for every run of the simulation as a pandas DataFrame object.&quot;&quot;&quot;</span> <span class="n">D</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_trials</span><span class="p">):</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&apos;Trial &apos;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="n">trial</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">open_trial_state_history</span><span class="p">(</span><span class="n">dir_path</span><span class="o">=</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">trial_id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="n">friends</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">state</span><span class="p">[</span><span class="s">&apos;friends&apos;</span><span class="p">]</span> <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">node_id</span> <span class="o">!=</span> <span class="s">&apos;topology&apos;</span> <span class="ow">and</span> <span class="n">state</span><span class="p">[</span><span class="s">&apos;id&apos;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">trial</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span> <span class="n">D</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">friends</span> <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
</code></pre>

<h2 id="estabelecendo-a-topologia">
Estabelecendo a topologia
</h2>
<p>
Vamos estabelecer novamente uma rede livre de escala de 100 nós onde as
interações vão acontecer.
</p>
<pre class="highlight"><code><span class="n">number_of_nodes</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">scale_free_graph</span><span class="p">(</span><span class="n">number_of_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">to_undirected</span><span class="p">()</span>
</code></pre>

<h2 id="novos-cenários">
Novos cenários
</h2>
<p>
O cenário básico já foi implementado no post anterior. Vamos retomar o
segundo cenário, <em>Escape</em>, onde cada nó, ao reconhecer um vizinho
zumbi, tem a chance de escapar e “cortar” o laço com ele. Ao código
original, adicionei apenas uma contagem para cada rodada de quantos
laços foram cortados (isso será importante na investigação posterior da
dinâmica da rede) e uma função que coleta as relações de cada nó em cada
rodada. Vamos ao código.
</p>
<pre class="highlight"><code><span class="k">class</span> <span class="nc">ZombieEscape</span><span class="p">(</span><span class="n">BaseNetworkAgent</span><span class="p">):</span> <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">agent_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="p">()):</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span> <span class="n">agent_id</span><span class="o">=</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span> <span class="bp">self</span><span class="o">.</span><span class="n">inf_prob</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_prob</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">while</span> <span class="bp">True</span><span class="p">:</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&apos;id&apos;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_you_fools</span><span class="p">()</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_for_infection</span><span class="p">()</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_friends</span><span class="p">()</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_net</span><span class="p">()</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span> <span class="k">def</span> <span class="nf">run_you_fools</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">zombie_neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighboring_agents</span><span class="p">(</span><span class="n">state_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">zombie_neighbors</span><span class="p">:</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_prob</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_topology</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">neighbor</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&apos;removed&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">neighbor</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span> <span class="k">print</span><span class="p">(</span><span class="s">&apos;Rejection:&apos;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s">&apos;Edge:&apos;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">neighbor</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&apos;</span><span class="se">\t</span><span class="s">&apos;</span><span class="p">)</span> <span class="k">def</span> <span class="nf">check_for_infection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">zombie_neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighboring_agents</span><span class="p">(</span><span class="n">state_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">zombie_neighbors</span><span class="p">:</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">inf_prob</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&apos;id&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># zombie</span> <span class="k">print</span><span class="p">(</span><span class="s">&apos;Infection:&apos;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="s">&apos;&lt;--&apos;</span><span class="p">,</span> <span class="n">neighbor</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&apos;</span><span class="se">\t</span><span class="s">&apos;</span><span class="p">)</span> <span class="k">break</span> <span class="k">def</span> <span class="nf">count_friends</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">human_neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighboring_agents</span><span class="p">(</span><span class="n">state_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&apos;friends&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">human_neighbors</span><span class="p">)</span> <span class="k">def</span> <span class="nf">get_net</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighboring_nodes</span><span class="p">()</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&apos;topology&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes</span>
</code></pre>

<p>
Agora vamos programar dois novos cenários, <em>Sentimentality</em> e
<em>Stigma</em>.
</p>
<h2 id="zombie-sentimentality">
Zombie Sentimentality
</h2>
<p>
Este cenário baseia-se no velho dilema de ter que matar um amigo que
acabou de ser mordido e que inevitavelmente se transformará num zumbi.
Segundo os autores do artigo, as tramas com zumbis normalmente
confrontam uma sociedade condenada com suas escolhas morais. Numa
sociedade onde acontece um apocalipse zumbi, a compaixão é colocada em
oposição à sobrevivência. Neste cenário, escapar torna-se mais difícil
por causa do laço afetivo entre as pessoas. Vamos ao código.
</p>
<pre class="highlight"><code><span class="k">class</span> <span class="nc">ZombieSentimentality</span><span class="p">(</span><span class="n">BaseNetworkAgent</span><span class="p">):</span> <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">agent_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="p">()):</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span> <span class="n">agent_id</span><span class="o">=</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span> <span class="bp">self</span><span class="o">.</span><span class="n">inf_prob</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_prob</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="bp">self</span><span class="o">.</span><span class="n">sent_coef</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">while</span> <span class="bp">True</span><span class="p">:</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&apos;id&apos;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_for_sentimentality</span><span class="p">()</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_for_infection</span><span class="p">()</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_friends</span><span class="p">()</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span> <span class="k">def</span> <span class="nf">check_for_infection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">zombie_neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighboring_agents</span><span class="p">(</span><span class="n">state_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">zombie_neighbors</span><span class="p">:</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">inf_prob</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&apos;id&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># zombie</span> <span class="k">print</span><span class="p">(</span><span class="s">&apos;Infection:&apos;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="s">&apos;&lt;--&apos;</span><span class="p">,</span> <span class="n">neighbor</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&apos;</span><span class="se">\t</span><span class="s">&apos;</span><span class="p">)</span> <span class="k">break</span> <span class="k">def</span> <span class="nf">check_for_sentimentality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">zombie_neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighboring_agents</span><span class="p">(</span><span class="n">state_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="n">sent_prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_prob</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sent_coef</span><span class="p">)</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">zombie_neighbors</span><span class="p">:</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">sent_prob</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_topology</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">neighbor</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span> <span class="k">print</span><span class="p">(</span><span class="s">&apos;Rejection:&apos;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s">&apos;Edge:&apos;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">neighbor</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&apos;</span><span class="se">\t</span><span class="s">&apos;</span><span class="p">)</span> <span class="k">def</span> <span class="nf">count_friends</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">human_neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighboring_agents</span><span class="p">(</span><span class="n">state_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&apos;friends&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">human_neighbors</span><span class="p">)</span>
</code></pre>

<p>
Vamos rodar agora as duas simulações e compará-las.
</p>
<pre class="highlight"><code><span class="c"># Simula&#xE7;&#xE3;o ZombieEscape</span>
<span class="c"># Starting out with a human population</span>
<span class="n">init_states</span> <span class="o">=</span> <span class="p">[{</span><span class="s">&apos;id&apos;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="p">}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_nodes</span><span class="p">)]</span> <span class="c"># Randomly seeding patient zero</span>
<span class="n">patient_zero</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_nodes</span><span class="p">)</span>
<span class="n">init_states</span><span class="p">[</span><span class="n">patient_zero</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&apos;id&apos;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span> <span class="c"># Setting up the simulation</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">NetworkSimulation</span><span class="p">(</span><span class="n">topology</span><span class="o">=</span><span class="n">G</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="n">init_states</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">ZombieEscape</span><span class="p">,</span> <span class="n">max_time</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="n">num_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">logging_interval</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s">&apos;sim_02&apos;</span><span class="p">)</span> <span class="c"># Running the simulation</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run_simulation</span><span class="p">()</span> <span class="c"># Simula&#xE7;&#xE3;o ZombieSentimentality</span>
<span class="c"># Starting out with a human population</span>
<span class="n">init_states</span> <span class="o">=</span> <span class="p">[{</span><span class="s">&apos;id&apos;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="p">}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_nodes</span><span class="p">)]</span> <span class="c"># Randomly seeding patient zero</span>
<span class="n">patient_zero</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_nodes</span><span class="p">)</span>
<span class="n">init_states</span><span class="p">[</span><span class="n">patient_zero</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&apos;id&apos;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span> <span class="c"># Setting up the simulation</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">NetworkSimulation</span><span class="p">(</span><span class="n">topology</span><span class="o">=</span><span class="n">G</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="n">init_states</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">ZombieSentimentality</span><span class="p">,</span> <span class="n">max_time</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="n">num_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">logging_interval</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s">&apos;sim_03&apos;</span><span class="p">)</span> <span class="c"># Running the simulation</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run_simulation</span><span class="p">()</span>
</code></pre>

<pre class="highlight"><code>Starting simulations...
---Trial 0---
Setting up agents...
Rejection:  0   Edge:   20  68
Written 28 items to pickled binary file: sim_02/log.0.state.pickled
---Trial 1---
Setting up agents...
Infection:  1   20  &lt;--  68
Infection:  1   54  &lt;--  20
Infection:  1   59  &lt;--  20
Rejection:  1   Edge:   76  20
Infection:  1   86  &lt;--  54
Infection:  1   91  &lt;--  20
Infection:  2   0   &lt;--  54
..........................
Infection:  8   72  &lt;--  0
Infection:  8   88  &lt;--  0
Infection:  8   96  &lt;--  1
Infection:  8   99  &lt;--  27
Infection:  9   38  &lt;--  19
Infection:  9   60  &lt;--  1
Infection:  9   67  &lt;--  4
Infection:  9   89  &lt;--  23
Infection:  10  35  &lt;--  0
Infection:  12  64  &lt;--  1
Written 28 items to pickled binary file: sim_03/log.99.state.pickled
Simulation completed.
</code></pre>

<p>
Vamos plotar agora o resultado final de Humanos X Zumbis para o cenário
<em>Escape</em> e para o cenário <em>Sentimentality</em> comparando-o
com o anterior.
</p>
<pre class="highlight"><code><span class="n">zombies</span> <span class="o">=</span> <span class="n">census_to_df</span><span class="p">(</span><span class="n">BaseLoggingAgent</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s">&apos;sim_02&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">humans</span> <span class="o">=</span> <span class="n">census_to_df</span><span class="p">(</span><span class="n">BaseLoggingAgent</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s">&apos;sim_02&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="c">## For later comparisons:</span>
<span class="n">mean_escape_zombies</span> <span class="o">=</span> <span class="n">zombies</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">mean_escape_humans</span> <span class="o">=</span> <span class="n">humans</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">zombies</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">&apos;b&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">zombies</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">zombies</span><span class="o">.</span><span class="nb">max</span><span class="p">(),</span> <span class="n">zombies</span><span class="o">.</span><span class="nb">min</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">&apos;b&apos;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">2</span><span class="p">)</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">humans</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">&apos;g&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">humans</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">humans</span><span class="o">.</span><span class="nb">max</span><span class="p">(),</span> <span class="n">humans</span><span class="o">.</span><span class="nb">min</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">&apos;g&apos;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">2</span><span class="p">)</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&apos;Escape ZombieApokalypse, $P_{inf} = 0.3$, $P_{run} = 0.1$&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&apos;Zombies&apos;</span><span class="p">,</span> <span class="s">&apos;Humans&apos;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmax</span><span class="o">=</span><span class="mi">27</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">28.</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&apos;Population&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&apos;Simulation time&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> <span class="c"># plotting sentimentality</span>
<span class="n">zombies</span> <span class="o">=</span> <span class="n">census_to_df</span><span class="p">(</span><span class="n">BaseLoggingAgent</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s">&apos;sim_03&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">humans</span> <span class="o">=</span> <span class="n">census_to_df</span><span class="p">(</span><span class="n">BaseLoggingAgent</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s">&apos;sim_03&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">zombies</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">&apos;r&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">humans</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">&apos;y&apos;</span><span class="p">)</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_escape_zombies</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&apos;b&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean_escape_humans</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&apos;g&apos;</span><span class="p">)</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&apos;Sentimentality ZombieApokalypse, $P_{inf} = 0.3$, $P_{run} = 0.1$, $P_{sent} = 0.05$&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&apos;&quot;Sentimentality&quot; Zombies&apos;</span><span class="p">,</span> <span class="s">&apos;&quot;Sentimentality&quot; Humans&apos;</span><span class="p">,</span> <span class="s">&apos;&quot;Escape&quot; Zombies&apos;</span><span class="p">,</span> <span class="s">&apos;&quot;Escape&quot; Humans&apos;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmax</span><span class="o">=</span><span class="mi">27</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">28.</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&apos;Population&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&apos;Simulation time&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>

<p>
<img src="http://neylsoncrepalde.github.io/img/2016-12-28-the-walking-dead-2/output_13_0.png" alt="png">
</p>
<p>
<img src="http://neylsoncrepalde.github.io/img/2016-12-28-the-walking-dead-2/output_13_1.png" alt="png">
</p>
<p>
É visível que, neste caso, o prender-se a um humano mordido acarreta em
maior sucesso da infestação zumbi. Agora, vamos considerar um quarto
cenário, <em>Stigma</em>.
</p>
<h2 id="zombie-stigma">
Zombie Stigma
</h2>
<p>
Neste cenário os autores simulam o “deixar as presas fáceis para trás”.
Isso, segundo Riebling e Schmitz (2016), pode ser visto como um indício
da erosão da moralidade humana. Aqueles humanos são considerados
“<em>zombie snack</em>” e só servem para atrasar o grupo são deixados
para trás. Vamos ao código e às simulações.
</p>
<pre class="highlight"><code><span class="k">class</span> <span class="nc">ZombieStigma</span><span class="p">(</span><span class="n">BaseNetworkAgent</span><span class="p">):</span> <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">agent_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="p">()):</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span> <span class="n">agent_id</span><span class="o">=</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span> <span class="bp">self</span><span class="o">.</span><span class="n">inf_prob</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_prob</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="bp">self</span><span class="o">.</span><span class="n">sent_coef</span> <span class="o">=</span> <span class="mi">0</span> <span class="bp">self</span><span class="o">.</span><span class="n">stigma_coef</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">while</span> <span class="bp">True</span><span class="p">:</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&apos;id&apos;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_for_sentimentality</span><span class="p">()</span> <span class="bp">self</span><span class="o">.</span><span class="n">stigmatize</span><span class="p">()</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_for_infection</span><span class="p">()</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_friends</span><span class="p">()</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span> <span class="k">def</span> <span class="nf">stigmatize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">human_neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighboring_agents</span><span class="p">(</span><span class="n">state_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">human_neighbors</span><span class="p">:</span> <span class="n">sorrounding_zombies</span> <span class="o">=</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">get_neighboring_agents</span><span class="p">(</span><span class="n">state_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sorrounding_zombies</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stigma_coef</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_topology</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">neighbor</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span> <span class="k">print</span><span class="p">(</span><span class="s">&apos;Stigmatize:&apos;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s">&apos;Edge:&apos;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">neighbor</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&apos;</span><span class="se">\t</span><span class="s">&apos;</span><span class="p">)</span> <span class="k">def</span> <span class="nf">check_for_infection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">zombie_neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighboring_agents</span><span class="p">(</span><span class="n">state_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">zombie_neighbors</span><span class="p">:</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">inf_prob</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&apos;id&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># zombie</span> <span class="k">print</span><span class="p">(</span><span class="s">&apos;Infection:&apos;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="s">&apos;&lt;--&apos;</span><span class="p">,</span> <span class="n">neighbor</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&apos;</span><span class="se">\t</span><span class="s">&apos;</span><span class="p">)</span> <span class="k">break</span> <span class="k">def</span> <span class="nf">check_for_sentimentality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">zombie_neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighboring_agents</span><span class="p">(</span><span class="n">state_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="n">sent_prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_prob</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sent_coef</span><span class="p">)</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">zombie_neighbors</span><span class="p">:</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">sent_prob</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_topology</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">neighbor</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span> <span class="k">print</span><span class="p">(</span><span class="s">&apos;Rejection:&apos;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s">&apos;Edge:&apos;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">neighbor</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&apos;</span><span class="se">\t</span><span class="s">&apos;</span><span class="p">)</span> <span class="k">def</span> <span class="nf">count_friends</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">human_neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_neighboring_agents</span><span class="p">(</span><span class="n">state_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s">&apos;friends&apos;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">human_neighbors</span><span class="p">)</span> <span class="c"># Simulando a Stigmatization</span>
<span class="c"># Starting out with a human population</span>
<span class="n">init_states</span> <span class="o">=</span> <span class="p">[{</span><span class="s">&apos;id&apos;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="p">}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_nodes</span><span class="p">)]</span> <span class="c"># Randomly seeding patient zero</span>
<span class="n">patient_zero</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_nodes</span><span class="p">)</span>
<span class="n">init_states</span><span class="p">[</span><span class="n">patient_zero</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&apos;id&apos;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span> <span class="c"># Setting up the simulation</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">NetworkSimulation</span><span class="p">(</span><span class="n">topology</span><span class="o">=</span><span class="n">G</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="n">init_states</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">ZombieStigma</span><span class="p">,</span> <span class="n">max_time</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="n">num_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">logging_interval</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s">&apos;sim_04&apos;</span><span class="p">)</span> <span class="c"># Running the simulation</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run_simulation</span><span class="p">()</span>
</code></pre>

<pre class="highlight"><code>Starting simulations...
---Trial 0---
Setting up agents...
Rejection:  0   Edge:   0   65
Written 28 items to pickled binary file: sim_04/log.0.state.pickled
---Trial 1---
Setting up agents...
Infection:  1   0   &lt;--  65
Rejection:  1   Edge:   2   0
Infection:  1   7   &lt;--  0
Rejection:  1   Edge:   10  0
Infection:  1   15  &lt;--  0
Infection:  1   21  &lt;--  0
Infection:  1   27  &lt;--  0
Infection:  1   28  &lt;--  15
Stigmatize: 1   Edge:   32  1
Infection:  1   33  &lt;--  0
Rejection:  1   Edge:   39  0
Rejection:  1   Edge:   48  0
Rejection:  1   Edge:   50  0
Infection:  1   66  &lt;--  0
Infection:  1   70  &lt;--  0
Stigmatize: 1   Edge:   74  13
Infection:  1   81  &lt;--  0
.........................
Rejection:  14  Edge:   99  27
Rejection:  15  Edge:   51  20
Rejection:  18  Edge:   32  1
Rejection:  18  Edge:   58  0
Rejection:  18  Edge:   90  1
Infection:  21  33  &lt;--  45
Written 28 items to pickled binary file: sim_04/log.99.state.pickled
Simulation completed.
</code></pre>

<p>
Vamos agora plotar os resultados de Humanos X Zumbis dessa simulação.
</p>
<pre class="highlight"><code><span class="c"># Zombie Stigmatization</span>
<span class="n">zombies</span> <span class="o">=</span> <span class="n">census_to_df</span><span class="p">(</span><span class="n">BaseLoggingAgent</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s">&apos;sim_04&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">humans</span> <span class="o">=</span> <span class="n">census_to_df</span><span class="p">(</span><span class="n">BaseLoggingAgent</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s">&apos;sim_04&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">zombies</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">&apos;b&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">zombies</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">zombies</span><span class="o">.</span><span class="nb">max</span><span class="p">(),</span> <span class="n">zombies</span><span class="o">.</span><span class="nb">min</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">&apos;b&apos;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">2</span><span class="p">)</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">humans</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">&apos;g&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">humans</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">humans</span><span class="o">.</span><span class="nb">max</span><span class="p">(),</span> <span class="n">humans</span><span class="o">.</span><span class="nb">min</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">&apos;g&apos;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">2</span><span class="p">)</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&apos;Stigma ZombieApokalypse, $P_{inf} = 0.3$, $P_{run} = 0.1$, $P_{sti}=0.02$&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&apos;Zombies&apos;</span><span class="p">,</span> <span class="s">&apos;Humans&apos;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmax</span><span class="o">=</span><span class="mi">27</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">28.</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&apos;Population&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&apos;Simulation time&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>

<p>
<img src="http://neylsoncrepalde.github.io/img/2016-12-28-the-walking-dead-2/output_18_0.png" alt="png">
</p>
<p>
Agora, vamos comparar o número médio de amigos humanos em cada um dos
três cenários aqui apresentados.
</p>
<pre class="highlight"><code><span class="n">escape_friends</span> <span class="o">=</span> <span class="n">friends_to_the_end</span><span class="p">(</span><span class="n">BaseLoggingAgent</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s">&apos;sim_02&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">sentimentality_friends</span> <span class="o">=</span> <span class="n">friends_to_the_end</span><span class="p">(</span><span class="n">BaseLoggingAgent</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s">&apos;sim_03&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">stigma_friends</span> <span class="o">=</span> <span class="n">friends_to_the_end</span><span class="p">(</span><span class="n">BaseLoggingAgent</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s">&apos;sim_04&apos;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">escape_friends</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">&apos;b&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sentimentality_friends</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">&apos;g&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stigma_friends</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s">&apos;r&apos;</span><span class="p">)</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&apos;Remaining Friends (Humans)&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&apos;Escape&apos;</span><span class="p">,</span> <span class="s">&apos;Sentimentality&apos;</span><span class="p">,</span> <span class="s">&apos;Stigma&apos;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s">&apos;best&apos;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmax</span><span class="o">=</span><span class="mi">27</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">28.</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&apos;Average number of friends&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&apos;Simulation time&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>

<p>
<img src="http://neylsoncrepalde.github.io/img/2016-12-28-the-walking-dead-2/output_20_1.png" alt="png">
</p>
<h2 id="investigando-a-dinâmica-da-rede">
Investigando a dinâmica da rede
</h2>
<p>
O cenário <em>Escape</em> pressupõe que os indivíduos, ao reconhecerem
um zumbi, tenham a chance de escapar e romper seu laço com ele. Desse
modo, podemos investigar a dinâmica da rede. Por isso, quando
programamos os agentes, definimos um atributo de cada agente como
“removidos” que guarda uma lista com os laços removidos de cada ator em
cada rodada. Vamos resgatar esses laços agora e removê-los da rede
inicial.
</p>
<pre class="highlight"><code><span class="n">log</span> <span class="o">=</span> <span class="n">BaseLoggingAgent</span><span class="o">.</span><span class="n">open_trial_state_history</span><span class="p">(</span><span class="n">dir_path</span><span class="o">=</span><span class="s">&apos;sim_02&apos;</span><span class="p">,</span> <span class="n">trial_id</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span> <span class="n">removidos</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">28</span><span class="p">):</span> <span class="k">print</span><span class="p">(</span><span class="s">&apos;Grafo no tempo &apos;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">))</span> <span class="n">remov</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span> <span class="k">try</span><span class="p">:</span> <span class="n">rem</span> <span class="o">=</span> <span class="n">log</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="n">node</span><span class="p">][</span><span class="s">&apos;removed&apos;</span><span class="p">]</span> <span class="n">remov</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rem</span><span class="p">)</span> <span class="k">print</span><span class="p">(</span><span class="n">rem</span><span class="p">)</span> <span class="k">except</span> <span class="nb">KeyError</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&apos;Sem removidos na rodada&apos;</span><span class="p">)</span> <span class="k">continue</span> <span class="n">removidos</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">=</span> <span class="n">remov</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">fruchterman_reingold_layout</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G1</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G1</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">G2</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G2</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">G3</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G3</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">G4</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G4</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="n">G5</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G5</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<span class="n">G6</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G6</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
<span class="n">G7</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G7</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
<span class="n">G8</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G8</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
<span class="n">G9</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G9</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
<span class="n">G10</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G10</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
<span class="n">G11</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G11</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span>
<span class="n">G12</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G12</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span>
<span class="n">G13</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G13</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
<span class="n">G14</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G14</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
<span class="n">G15</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G15</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">15</span><span class="p">])</span>
<span class="n">G16</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G16</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">16</span><span class="p">])</span>
<span class="n">G17</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G17</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">17</span><span class="p">])</span>
<span class="n">G18</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G18</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span>
<span class="n">G19</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G19</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">19</span><span class="p">])</span>
<span class="n">G20</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G20</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">20</span><span class="p">])</span>
<span class="n">G21</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G21</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">21</span><span class="p">])</span>
<span class="n">G22</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G22</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">22</span><span class="p">])</span>
<span class="n">G23</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G23</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">23</span><span class="p">])</span>
<span class="n">G24</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G24</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">24</span><span class="p">])</span>
<span class="n">G25</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G25</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">25</span><span class="p">])</span>
<span class="n">G26</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G26</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">26</span><span class="p">])</span>
<span class="n">G27</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">G27</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">removidos</span><span class="p">[</span><span class="mi">27</span><span class="p">])</span>
<span class="n">grafos</span> <span class="o">=</span> <span class="p">[</span><span class="n">G</span><span class="p">,</span><span class="n">G1</span><span class="p">,</span><span class="n">G2</span><span class="p">,</span><span class="n">G3</span><span class="p">,</span><span class="n">G4</span><span class="p">,</span><span class="n">G5</span><span class="p">,</span><span class="n">G6</span><span class="p">,</span><span class="n">G7</span><span class="p">,</span><span class="n">G8</span><span class="p">,</span><span class="n">G9</span><span class="p">,</span><span class="n">G10</span><span class="p">,</span><span class="n">G11</span><span class="p">,</span><span class="n">G12</span><span class="p">,</span><span class="n">G13</span><span class="p">,</span><span class="n">G14</span><span class="p">,</span><span class="n">G15</span><span class="p">,</span><span class="n">G16</span><span class="p">,</span><span class="n">G17</span><span class="p">,</span><span class="n">G18</span><span class="p">,</span><span class="n">G19</span><span class="p">,</span> <span class="n">G20</span><span class="p">,</span><span class="n">G21</span><span class="p">,</span><span class="n">G22</span><span class="p">,</span><span class="n">G23</span><span class="p">,</span><span class="n">G24</span><span class="p">,</span><span class="n">G25</span><span class="p">,</span><span class="n">G26</span><span class="p">,</span><span class="n">G27</span><span class="p">]</span>
</code></pre>

<p>
Agora, vamos salvar uma figura para cada grafo e, usando o comando
ffmpeg discutido na postagem passada, fazer um vídeo com a dinâmica.
</p>
<pre class="highlight"><code><span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">28</span><span class="p">):</span> <span class="n">cor</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_nodes</span><span class="p">):</span> <span class="n">cor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">log</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s">&apos;id&apos;</span><span class="p">])</span> <span class="n">cores</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">cor</span><span class="p">:</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">cores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&apos;red&apos;</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="n">cores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&apos;lightgreen&apos;</span><span class="p">)</span> <span class="c">#plotando a rede</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&apos;off&apos;</span><span class="p">)</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">fruchterman_reingold_layout</span><span class="p">(</span><span class="n">grafos</span><span class="p">[</span><span class="n">time</span><span class="p">])</span> <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">grafos</span><span class="p">[</span><span class="n">time</span><span class="p">],</span><span class="n">pos</span><span class="p">,</span><span class="n">node_size</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span><span class="n">node_color</span><span class="o">=</span><span class="n">cores</span><span class="p">)</span> <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">grafos</span><span class="p">[</span><span class="n">time</span><span class="p">],</span><span class="n">pos</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&apos;Infection - Time &apos;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span> <span class="n">dens</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">grafos</span><span class="p">[</span><span class="n">time</span><span class="p">])</span> <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">&apos;Densidade = &apos;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dens</span><span class="p">))</span> <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&apos;/home/neylson/diffusion_model/figuras_escape/image00&apos;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s">&apos;.png&apos;</span><span class="p">)</span> <span class="k">elif</span> <span class="n">time</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&apos;/home/neylson/diffusion_model/figuras_escape/image0&apos;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s">&apos;.png&apos;</span><span class="p">)</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>

<p>
Podemos transformar todos os plots em um vídeo para facilitar a
visualização com ffmpeg. Aqui está o código para fazer um slide show.
</p>
<pre><code class="language-linux">ffmpeg -framerate 1 -i image%03d.png output.mp4
</code></pre>
<p>
Clique no grafo abaixo para visualizar:
</p>
<p>
<a href="http://neylsoncrepalde.github.io/output_escape.mp4"><img src="http://neylsoncrepalde.github.io/img/2016-12-28-the-walking-dead-2/output_24_26.png" alt="png"></a>
</p>
<p>
Podemos ver claramente como os agentes que conseguiram “escapar” ficam
isolados da rede de zumbis e à salvo. Agora, vamos plotar a dinâmica da
densidade da rede. Poderíamos investigar qualquer outra medida comum à
análise de redes sociais.
</p>
<pre class="highlight"><code><span class="n">densidades</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">28</span><span class="p">):</span> <span class="n">dens</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">grafos</span><span class="p">[</span><span class="n">time</span><span class="p">])</span> <span class="n">densidades</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dens</span><span class="p">)</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">densidades</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&apos;orange&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&apos;Escape ZombieApokalypse, $P_{inf} = 0.3$, $P_{run} = 0.2$&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmax</span><span class="o">=</span><span class="mi">27</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&apos;Time&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&apos;Density&apos;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>

<p>
<img src="http://neylsoncrepalde.github.io/img/2016-12-28-the-walking-dead-2/output_26_0.png" alt="png">
</p>
<p>
A medida da densidade mostra o quão conectada é a rede. Ela é obtida
através do cálculo do número de laços observados sobre o número total de
laços possíveis num grafo. Formalmente,
</p>
<p>
<img src="http://neylsoncrepalde.github.io/img/2016-12-28-the-walking-dead-2/densidade.png" alt="png">
</p>
<p>
onde <em>g</em> é o número de laços do grafo e <em>L</em> o número de
laços observados. O gráfico mostra como a densidade da rede vai
abaixando à medida que alguns humanos conseguem escapar e ficar numa
posição segura isolados de outros zumbis.
</p>
<p>
Por hoje é só. Comentários na postagem são sempre bem vindos! Abraços!
</p>
</article>
<p class="blog-tags">
Tags: Python, rstats, Social Network Analysis, Network Diffusion Models,
Infection Dynamics
</p>

