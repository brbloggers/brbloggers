<div id="post-content"> <p>Ol&#xE1;! Tudo bem? Eu sou a <a href="https://github.com/brunaw">Bruna</a>, e talvez voc&#xEA; j&#xE1; me conhe&#xE7;a de algum grupo de R no Telegram ou Facebook, ou mesmo pelo meu outro pacote, o<br>
<a href="https://cran.r-project.org/web/packages/vagalumeR/index.html">vagalumeR</a>. Eu estou prestes a me formar em Estat&#xED;stica na UFPR, e esse post vai ter muito a ver com o tema do meu trabalho de conclus&#xE3;o de curso, que est&#xE1; sendo feito sob orienta&#xE7;&#xE3;o do Professor <a href="https://github.com/walmes">Walmes Zeviani</a>.</p>
<p>Recentemente, eu fiz a primeira vers&#xE3;o do pacote do meu TCC, o <code>chorrrds</code>. Ainda tem muito a ser feito nele, mas os primeiros resultados j&#xE1; s&#xE3;o bem legais. O pacote <code>chorrrds</code> pode ser utilizado para a obten&#xE7;&#xE3;o acordes de m&#xFA;sicas, atrav&#xE9;s da raspagem do site <a href="https://www.cifraclub.com.br/">CifraClub</a>. Junto com o pacote j&#xE1; v&#xEA;m diversos bancos de dados relativos &#xE0; m&#xFA;sica brasileira. Ele j&#xE1; est&#xE1; dispon&#xED;vel no CRAN, mas as pr&#xF3;ximas atualiza&#xE7;&#xF5;es devem sair em primeira m&#xE3;o nesse reposit&#xF3;rio: <a href="https://github.com/brunaw/chorrrds" class="uri">https://github.com/brunaw/chorrrds</a></p>
<pre class="r"><code># Instala&#xE7;&#xE3;o
devtools::install_github(&quot;brunaw/chorrrds&quot;)
# ou
install.packages(&quot;chorrrds&quot;) # do CRAN
data(package = &quot;chorrrds&quot;)</code></pre>
<p>A base de dados chamada <code>all</code>, presente no pacote, cont&#xE9;m dados referentes a 106 artistas nacionais, dos gen&#xEA;ros: &#x201C;rock&#x201D;, &#x201C;pop&#x201D;, &#x201C;sertanejo&#x201D;, &#x201C;MPB&#x201D;, &#x201C;bossa nova&#x201D;, &#x201C;forr&#xF3;&#x201D;, &#x201C;reggae&#x201D; e &#x201C;samba&#x201D;. Ela j&#xE1; cont&#xE9;m, al&#xE9;m das vari&#xE1;veis extra&#xED;das com o pacote, as datas de lan&#xE7;amento e a popularidade das m&#xFA;sicas, obtidas atrav&#xE9;s da API do <a href="https://github.com/tiagomendesdantas/Rspotify">Spotify</a>. Os detalhes sobre a sele&#xE7;&#xE3;o dos artistas e combina&#xE7;&#xE3;o dos dados com os do Spotify ser&#xE3;o omitidos por enquanto, mas quem quiser falar sobre isso comigo, pode ficar a vontade :)</p>
<p>Ent&#xE3;o vamos l&#xE1;. Eu vou come&#xE7;ar acertando alguns pontos sobre os dados, j&#xE1; que eles n&#xE3;o est&#xE3;o perfeitos, como:</p>
<ul>
<li>Deixar apenas os anos de lan&#xE7;amento das m&#xFA;sicas, e n&#xE3;o a data completa;</li>
<li>Encontrar as formas mais simples dos acordes (sem acidentes ou extens&#xF5;es);</li>
<li>Conectar a base original com a dos gen&#xEA;ros dos artistas;</li>
<li>Consertar enarmonias, ou seja, transformar as diferentes vers&#xF5;es de um acorde com as mesmas notas em uma coisa s&#xF3; (por exemplo, Gb passa a ser F#, j&#xE1; que na pr&#xE1;tica eles s&#xE3;o iguais).</li>
</ul>
<pre class="r"><code>library(tidyverse) # Base de g&#xEA;neros
genre &lt;- chorrrds::genre da &lt;- chorrrds::all %&gt;% dplyr::mutate(date = stringr::str_extract(date, pattern = &quot;[0-9]{4,}&quot;)) %&gt;% # Extrai apenas os anos dplyr::mutate(date = as.numeric(date), # Deixa as datas como valores num&#xE9;ricos acorde = stringr::str_extract(chord, # Extrai as partes fundamentais dos pattern = &quot;^([A-G]#?b?)&quot;)) %&gt;% # acordes dplyr::filter(date &gt; 1900) %&gt;% # Mant&#xE9;m apenas os anos que fazem sentido dplyr::left_join(genre, by = &quot;artist&quot;) %&gt;% # Traz os g&#xEA;neros dos artistas dplyr::mutate(acorde = case_when( # Contribui&#xE7;&#xE3;o do Julio acorde == &quot;Gb&quot; ~ &quot;F#&quot;, acorde == &quot;C#&quot; ~ &quot;Db&quot;, acorde == &quot;G#&quot; ~ &quot;Ab&quot;, acorde == &quot;A#&quot; ~ &quot;Bb&quot;, acorde == &quot;D#&quot; ~ &quot;Eb&quot;, acorde == &quot;E#&quot; ~ &quot;F&quot;, acorde == &quot;B#&quot; ~ &quot;C&quot;, TRUE ~ acorde)) # Convers&#xE3;o de enarmonias head(da)</code></pre>
<table>
<colgroup>
<col width="5%">
<col width="39%">
<col width="6%">
<col width="6%">
<col width="4%">
<col width="20%">
<col width="7%">
<col width="6%">
</colgroup>
<thead> </thead>
<tbody>
<tr class="odd">
<td>1992</td>
<td>adriana calcanhotto a fabrica do poema</td>
<td>51</td>
<td>Cm</td>
<td>D#</td>
<td>adriana calcanhotto</td>
<td>C</td>
<td>MPB</td>
</tr>
<tr class="even">
<td>1992</td>
<td>adriana calcanhotto a fabrica do poema</td>
<td>51</td>
<td>Ab</td>
<td>D#</td>
<td>adriana calcanhotto</td>
<td>Ab</td>
<td>MPB</td>
</tr>
<tr class="odd">
<td>1992</td>
<td>adriana calcanhotto a fabrica do poema</td>
<td>51</td>
<td>Db7</td>
<td>D#</td>
<td>adriana calcanhotto</td>
<td>Db</td>
<td>MPB</td>
</tr>
<tr class="even">
<td>1992</td>
<td>adriana calcanhotto a fabrica do poema</td>
<td>51</td>
<td>Db7/9</td>
<td>D#</td>
<td>adriana calcanhotto</td>
<td>Db</td>
<td>MPB</td>
</tr>
<tr class="odd">
<td>1992</td>
<td>adriana calcanhotto a fabrica do poema</td>
<td>51</td>
<td>Cm</td>
<td>D#</td>
<td>adriana calcanhotto</td>
<td>C</td>
<td>MPB</td>
</tr>
<tr class="even">
<td>1992</td>
<td>adriana calcanhotto a fabrica do poema</td>
<td>51</td>
<td>Fm</td>
<td>D#</td>
<td>adriana calcanhotto</td>
<td>F</td>
<td>MPB</td>
</tr>
</tbody>
</table>
<p>A base est&#xE1; no formato longo, ou seja, temos uma linha para cada acorde da m&#xFA;sica, mantendo a sequ&#xEA;ncia na qual eles aparecem no site.</p>
<p>Muito se fala sobre o quanto as m&#xFA;sicas no Brasil andam ficando mais &#x201C;simples&#x201D;, ou que alguns gen&#xEA;ros musicais s&#xE3;o mais ricos que outros. Com os dados que temos, ser&#xE1; que &#xE9; poss&#xED;vel concluir algo sobre isso olhando simplesmente para a quantidade m&#xE9;dia de acordes por m&#xFA;sica ao longo dos anos? Vejamos o gr&#xE1;fico a seguir.</p>
<pre class="r"><code>da_g &lt;- da %&gt;% # 2018 ainda n&#xE3;o &#xE9; um ano completo dplyr::mutate(date &lt; 2018) %&gt;% # Agrupamento por data + acorde + musica dplyr::group_by(date, genre, music, chord) %&gt;% # Mant&#xE9;m os acordes distintos/ano dplyr::summarise(distintos = n_distinct(chord)) %&gt;% dplyr::summarise(cont = n()) %&gt;% # M&#xE9;dia de acordes distintos nas m&#xFA;sicas/ano dplyr::summarise(media = mean(cont), contagem = n()) # grafico
p &lt;- da_g %&gt;% ggplot(aes(x = date, y = media)) + geom_point(colour = &quot;skyblue3&quot;) + facet_wrap(&quot;genre&quot;) + geom_smooth(span = 0.65, colour = &quot;white&quot;, fill = &quot;tan&quot;) + scale_fill_hue(c = 55, l = 75) + labs(x = &quot;Anos&quot;, y = &quot;M&#xE9;dia de acordes/m&#xFA;sica&quot;) # tema para deixar o gr&#xE1;fico bonitinho
tema &lt;- theme( legend.position=&apos;none&apos;, axis.line = element_line(size = 0.5, colour = &quot;tan&quot;), panel.grid.major = element_line( colour = &quot;black&quot;, size = 0.08, linetype = &quot;dotted&quot;), panel.border = element_blank(), panel.background = element_blank(), strip.background = element_rect(colour = &quot;tan&quot;, fill = &quot;white&quot;, size = 0.6), strip.text = element_text(size = 14), axis.title = element_text(size = 14), axis.text = element_text(size = 12)) p + tema</code></pre>
<p><img src="http://curso-r.com/blog/2018-04-25-chorrrds/media-acordes-musica.png"></p>
<p>Claramente, g&#xEA;neros como o samba, MPB e bossa nova t&#xEA;m, em geral, uma quantidade m&#xE9;dia de acordes distintos por m&#xFA;sica muito maior do que os outros. E eles t&#xEA;m mais varia&#xE7;&#xE3;o ao longo dos anos tamb&#xE9;m, o que pode ser um reflexo da maior criatividade envolvida nestes gen&#xEA;ros. Os menores valores, como &#xE9; esperado, est&#xE3;o principalmente no sertanejo, que &#xE9; um gen&#xEA;ro conhecidamente mais uniforme na quest&#xE3;o harm&#xF4;nica.</p>
<p>N&#xF3;s podemos avan&#xE7;ar um pouco e olhar para os pr&#xF3;prios artistas. Quem ser&#xE1; que usa as maiores quantidades de acordes distintos em suas composi&#xE7;&#xF5;es? Vamos ver o pr&#xF3;ximo gr&#xE1;fico, que mostra apenas os artistas com mediana maior do que 8 acordes diferentes por m&#xFA;sica.</p>
<pre class="r"><code>da_g &lt;- da %&gt;% dplyr::mutate(artist = stringr::str_to_title(artist)) %&gt;% # Agrupamento por artista + m&#xFA;sica dplyr::group_by(artist, genre, music) %&gt;% # Mant&#xE9;m os acordes distintos dplyr::summarise(distintos = n_distinct(chord)) %&gt;% # Obt&#xE9;m a mediana e quantis de acordes distintos por m&#xFA;sica/artistas dplyr::summarise(med = median(distintos), contagem = n(), inf = quantile(distintos)[2], sup = quantile(distintos)[4]) # grafico
p &lt;- da_g %&gt;% dplyr::filter(med &gt; 8) %&gt;% ggplot(aes(x = reorder(artist, med), y = med)) + geom_pointrange(aes(ymin = inf, ymax = sup, colour = genre), size = 0.7) + scale_colour_hue(c = 55, l = 75) + coord_flip() + labs(colour = &quot;G&#xEA;nero&quot;, x = &quot;Artistas&quot;, y = &quot;Primeiro quartil, mediana e terceiro quartil&quot;) # tema
tema &lt;- theme( axis.line = element_line(size = 0.5, colour = &quot;tan&quot;), panel.grid.major = element_line(colour = &quot;black&quot;, size = 0.08, linetype = &quot;dotted&quot;), panel.border = element_blank(), panel.background = element_blank(), axis.text = element_text(size = 12), axis.title.x = element_text(size = 16), axis.title.y = element_text(size = 16)) p + tema</code></pre>
<p><img src="http://curso-r.com/blog/2018-04-25-chorrrds/stats-artistas.png"></p>
<p>E <em>voil&#xE1;</em>. A primeira posi&#xE7;&#xE3;o &#xE9; ocupada por um dos maiores musicistas brasileiros, que &#xE9; refer&#xEA;ncia internacional em quest&#xF5;es de harmonia: Chico Buarque. Logo em seguida, temos o Reinaldo, um dos maiores sambistas que o Brasil j&#xE1; conheceu, e o Pixinguinha, um g&#xEA;nio do choro. E assim a lista segue, com artistas principalmente da bossa nova, samba e MPB. Demora at&#xE9; que apare&#xE7;a o primeiro dos rockeiros nesta lista, que &#xE9; a Rita Lee. Dos membros do sertanejo, nenhum chega a aparecer no gr&#xE1;fico, mostrando que a &#x201C;variedade&#x201D; harm&#xF4;nica deste g&#xEA;nero musical &#xE9; mesmo bem baixa.</p>
<p>At&#xE9; agora est&#xE1; legal mas, com m&#xFA;sica, sempre pode ficar ainda mais. A ideia mais recente que o meu caro orientador <a href="https://github.com/walmes">Walmes Zeviani</a> teve para o nosso trabalho &#xE9; de encadear as transi&#xE7;&#xF5;es entre os acordes em um diagrama de cordas. Voc&#xEA;s j&#xE1; ouviram falar desse diagrama? Eu mal o conhe&#xE7;o e j&#xE1; considero pacas.</p>
<p>O diagrama de cordas &#xE9; um m&#xE9;todo gr&#xE1;fico (e lindo) de explicitar rela&#xE7;&#xF5;es entre grupos ou indiv&#xED;duos. Os grupos ficam arranjados de forma radial/circular, e as cordas que aparecem dentro do c&#xED;rculo demonstram as conex&#xF5;es entre eles e suas for&#xE7;as. Pra quem sabe um pouquinho sobre harmonia, vai ser sensacional ver o quanto isso faz sentido (mas tamb&#xE9;m n&#xE3;o vou entrar nesse m&#xE9;rito agora).</p>
<p>O exemplo que eu vou mostrar aqui &#xE9; extremamente simples. Antes eu separei, dos acordes &#x201C;crus&#x201D; retirados do CifraClub, apenas a parte fundamental deles. Isto &#xE9;, desconsiderei se um acorde tem notas extras, acidentes e maior/menor. Ou seja, aqui n&#xF3;s s&#xF3; veremos acordes como C, D, B, A#, o miolo da coisa. Podemos perder informa&#xE7;&#xE3;o fazendo isso? Sim, e bastante. Mas como eu disse, esse caso &#xE9; pra ser bem simples mesmo.</p>
<p>Enfim, vamos voltar ao exemplo. A seguir, eu considero como uma &#x201C;transi&#xE7;&#xE3;o&#x201D; quando um acorde aparece em sequ&#xEA;ncia do outro (exemplo de transi&#xE7;&#xE3;o muito comum: d&#xF3;-sol). O c&#xF3;digo abaixo constr&#xF3;i o diagrama de cordas atrav&#xE9;s do pacote <code>chordiag</code>:</p>
<pre class="r"><code>devtools::install_github(&quot;mattflor/chorddiag&quot;)</code></pre>
<pre class="r"><code># Ordenando por c&#xED;rculo das quintas
ordem &lt;- c(&quot;G&quot;, &quot;D&quot;, &quot;A&quot;, &quot;E&quot;, &quot;B&quot;, &quot;F#&quot;, &quot;Db&quot;, &quot;Ab&quot;, &quot;Eb&quot;, &quot;Bb&quot;, &quot;F&quot;, &quot;C&quot;) da$acorde &lt;- factor(da$acorde, levels = ordem) comp &lt;- data.frame( acorde = da$acorde, seq = dplyr::lead(da$acorde)) %&gt;% # Pega o acorde &quot;seguinte&quot; dplyr::group_by(acorde, seq) %&gt;% # Agrupa por cada transi&#xE7;&#xE3;o dplyr::summarise(contagem = n()) # Conta quantas s&#xE3;o as transi&#xE7;&#xF5;es mat_comp &lt;- reshape2::dcast(comp, # Arranja em do tipo matriz quadrada acorde ~ seq, value.var = &quot;contagem&quot;) mm &lt;- as.matrix(mat_comp[ ,-1]) # Converte o df em matriz (exig&#xEA;ncia do pacote)
mm[is.na(mm)] &lt;- 0 # Substitui na por 0 (exig&#xEA;ncia do pacote)
dimnames(mm) &lt;- list(acorde = unique(mat_comp$acorde), seq = unique(mat_comp$acorde)) # Constr&#xF3;i o diagrama interativo
chorddiag::chorddiag(mm, showTicks = FALSE, palette = &quot;Set2&quot;, palette2 = &quot;#Set3&quot;)</code></pre> <p>Vejam que interessante. Como eu disse antes, uma das rela&#xE7;&#xF5;es mais fortes do diagrama &#xE9; o C-G (ou d&#xF3;-sol), que &#xE9; justificada teoricamente, j&#xE1; que o G &#xE9; a quinta do C. O mesmo acontece com D-A, A-E, F-C e assim por diante. Quem quiser saber mais sobre esse comportamento, pode dar uma olhada <a href="https://ledgernote.com/columns/music-theory/circle-of-fifths-explained/">aqui</a>. Transi&#xE7;&#xF5;es meio malucas, como B-Bb, tamb&#xE9;m acontecem. &#x201C;Maluca&#x201D; porque um acorde bemol, indicado pelo &#x201C;b&#x201D;, &#xE9; aquele cuja ra&#xED;z esta meio tom abaixo do indicado pela letra anterior, que neste caso &#xE9; o B (si), ent&#xE3;o esse acontecimento n&#xE3;o faz muito sentido.</p>
<div id="consideracoes-finais" class="section level1"> <p>O que vimos aqui &#xE9; um peda&#xE7;o da an&#xE1;lise inicial do meu TCC, que ainda n&#xE3;o est&#xE1; nem um pouco pronto. S&#xE3;o exemplos simples das informa&#xE7;&#xF5;es podemos extrair com o pacote <code>chorrrds</code>, e o universo de possibilidades &#xE9; infinito. Isso que n&#xF3;s nem come&#xE7;amos a falar sobre as conex&#xF5;es que podem ser feitas com a API do Spotify, o pacote <code>music21</code>, que &#xE9; do pr&#xF3;prio Julio Trecenti, com as letras das m&#xFA;sicas,&#x2026;</p>
<p>Al&#xE9;m disso, om certeza, meu objetivo com os gr&#xE1;ficos apresentados n&#xE3;o &#xE9; fazer nenhum tipo de ju&#xED;zo de valor sobre os gen&#xEA;ros por conta de &#x201C;complexidade harm&#xF4;nica&#x201D;. Diga-se de passagem, eu mesma sou bem f&#xE3; de todos esses gen&#xEA;ros, desde a MPB at&#xE9; o sertanejo :D</p>
</div>
<div id="agradecimentos" class="section level1"> <p>Ao meu orientador, <a href="https://github.com/walmes">Walmes Zeviani</a>, que fez eu me apaixonar pelo R, e ao <a href="http://curso-r.com/author/julio/">Julio Trecenti</a>, que &#xE9; t&#xE3;o entusiasta do meu TCC quanto eu, e j&#xE1; fez diversas contribui&#xE7;&#xF5;es valiosas.</p>
</div> </div>
