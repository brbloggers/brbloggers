+++
title = "Censo da Educação Superior (1) - Quais são as cidades mais universitárias do Brasil?"
date = "2016-06-07 03:00:00"
categories = ["paixao-por-dados"]
original_url = "http://sillasgonzaga.github.io/2016-06-07-censo_educ_superior1/"
+++

<article class="blog-post">
<p>
Recentemente, discuti com um amigo meu que afirmou que Aracaju, cidade
onde moramos, é uma capital universitária - ou seja, uma cidade que
atrai muitos estudantes de fora -, que eu não acredito que seja verdade.
Mas não há melhor maneira de responder a isso senão com análise de
dados, não é mesmo?
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="n">library</span><span class="p">(</span><span class="n">data.table</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gdata</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">feather</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggthemes</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">microbenchmark</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gridExtra</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">cowplot</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gtable</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggrepel</span><span class="p">)</span><span class="w">
</span><span class="n">setwd</span><span class="p">(</span><span class="s2">&quot;/home/sillas/R/Projetos/CensoEducSuperior/Dados&quot;</span><span class="p">)</span></code></pre>
</figure>
<h2 id="introdução">
Introdução
</h2>
<p>
Os dados que podem tirar essa dúvida, além de trazer a luz muitas outras
informações interessantes, são os microdados do
<a href="http://portal.inep.gov.br/basica-levantamentos-microdados">Censo
da Educação Superior</a>, disponibilizados pelo Instituto Nacional de
Estudos e Pesquisas Educacionais Anísio Teixeira, o
<a href="http://portal.inep.gov.br/">Inep</a>. Segundo o
<a href="http://dados.gov.br/dataset/microdados-do-censo-da-educacao-superior">Portal
Brasileiro de Dados</a>:
</p>
<blockquote>
<p>
Anualmente, o Inep realiza a coleta de dados sobre a educação superior,
com o objetivo de oferecer informações detalhadas sobre a situação atual
e as grandes tendências do setor, tanto à comunidade acadêmica quanto à
sociedade em geral. A coleta dos dados tem como referência as diretrizes
gerais previstas pelo Decreto nº 6.425 de 4 de abril de 2008. O censo da
educação superior reúne informações sobre as instituições de ensino
superior, seus cursos de graduação presencial ou a distância, cursos
seqüenciais, vagas oferecidas, inscrições, matrículas, ingressantes e
concluintes, além de informações sobre docentes, nas diferentes formas
de organização acadêmica e categoria administrativa.
</p>
</blockquote>
<p>
Para saber mais: <http://www.censosuperior.inep.gov.br/>
</p>
<p>
Os dados mais atualizados disponíveis ao público são de 2014. Neste
post, mostrarei todo o processo da análise dos dados, composto por
limpeza, manipulação e apresentação dos resultados.
</p>
<h2 id="limpeza-de-dados">
Limpeza de dados
</h2>
<p>
O arquivo principal desta análise, o
<code class="highlighter-rouge">DM\_ALUNO.csv</code>, é um arquivo de
5,4 GB onde as colunas são separadas pelo caractere
<code class="highlighter-rouge">|</code>. Como só tenho 4 GB de memória
RAM em meu notebook, o R não conseguirá importar este arquivo da maneira
tradicional. Contudo, não é necessário carregar o arquivo para o R para
saber algumas características sobre ele. O dicionário dos microdados,
disponível na planilha ANEXO I - 2014, informa que existem 117 colunas
no arquivo em questão. Felizmente, para responder a pergunta deste post,
só precisamos de quatro colunas:
</p>
<ul>
<li>
<code class="highlighter-rouge">CO\_IES</code>, que informa o código
único de identificação da IES do aluno;
</li>
<li>
<code class="highlighter-rouge">CO\_UF\_NASCIMENTO</code>, que informa o
código do estado de nascimento do aluno;
</li>
<li>
<code class="highlighter-rouge">CO\_MUNICIPIO\_NASCIMENTO</code>, que
informa o código do nascimento do aluno;
</li>
<li>
<code class="highlighter-rouge">ANO\_INGRESSO</code>, que informa o ano
de ingresso do aluno no curso.
</li>
</ul>
<p>
Obs.: Veja que a variável
<code class="highlighter-rouge">ANO\_INGRESSO</code> diz respeito ao
aluno que entrou no curso e não na universidade. Como mudanças de curso
não são tão frequentes assim e como o volume de dados é muito grande,
fazendo com que essas incertezas não prejudiquem o resultado, ignorarei
esse detalhe nos resultados.
</p>
<p>
Para importar apenas essas colunas para o R, a melhor opção foi usar um
comando em bash, que é muito mais rápido que o R para tarefas de
tratamento de arquivos de texto. O que eu fiz foi criar um novo arquivo,
chamado de <code class="highlighter-rouge">DM\_ALUNO\_novo.csv</code>,
com apenas essas quatro variáveis:
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># colunas importantes: CO_IES (1), UF(40), CO_MUNICIPIO_NASCIMENTO(41), ANO_INGRESSO (117)</span><span class="w">
</span><span class="c1"># cut_sh &lt;- &quot;cut -d &apos;|&apos; -f 1,40,41,117 DM_ALUNO.csv &gt; DM_ALUNO_novo.csv&quot;</span><span class="w">
</span><span class="c1"># system.time(system(cut_sh))</span><span class="w"> </span><span class="c1"># A opera&#xE7;&#xE3;o acima leva cerca de 20 segundos para ser executada</span><span class="w"> </span><span class="c1"># Comparando os dois arquivos:</span><span class="w">
</span><span class="n">file.size</span><span class="p">(</span><span class="s2">&quot;DM_ALUNO.csv&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">humanReadable</span><span class="p">()</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Error in if (any(x &lt; 0)) stop(&quot;&apos;x&apos; must be positive&quot;): missing value where TRUE/FALSE needed</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="n">file.size</span><span class="p">((</span><span class="s2">&quot;DM_ALUNO_novo.csv&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">humanReadable</span><span class="p">()</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Error in if (any(x &lt; 0)) stop(&quot;&apos;x&apos; must be positive&quot;): missing value where TRUE/FALSE needed</code></pre>
</figure>
<p>
Assim, o arquivo a ser importado tem apenas 195,5 MB. Contudo, como ele
tem muitas linhas, escolhi o pacote
<code class="highlighter-rouge">data.table</code> para importar e
manipular os dados:
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="n">system.time</span><span class="p">(</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fread</span><span class="p">(</span><span class="s2">&quot;DM_ALUNO_novo.csv&quot;</span><span class="p">))</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Error in fread(&quot;DM_ALUNO_novo.csv&quot;): File &apos;DM_ALUNO_novo.csv&apos; does not exist. Include one or more spaces to consider the input a system command.</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Timing stopped at: 0 0 0</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">format</span><span class="p">(</span><span class="n">big.mark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">decimal.mark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="w">
</span><span class="n">paste0</span><span class="p">(</span><span class="s2">&quot;Quantidade de linhas do arquivo importado: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## [1] &quot;Quantidade de linhas do arquivo importado: 8.041.338&quot;</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="n">head</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## CO_IES CO_UF_NASCIMENTO CO_MUNICIPIO_NASCIMENTO ANO_INGRESSO
## 1: 1 51 5108402 2012
## 2: 1 51 5103403 2012
## 3: 1 51 5103403 2012
## 4: 1 51 5103403 2014
## 5: 1 51 5103403 2011
## 6: 1 51 5103403 2011
## NO_IES SGL_IES DS_CATEGORIA_ADMINISTRATIVA
## 1: UNIVERSIDADE FEDERAL DE MATO GROSSO UFMT P&#xFA;blica Federal
## 2: UNIVERSIDADE FEDERAL DE MATO GROSSO UFMT P&#xFA;blica Federal
## 3: UNIVERSIDADE FEDERAL DE MATO GROSSO UFMT P&#xFA;blica Federal
## 4: UNIVERSIDADE FEDERAL DE MATO GROSSO UFMT P&#xFA;blica Federal
## 5: UNIVERSIDADE FEDERAL DE MATO GROSSO UFMT P&#xFA;blica Federal
## 6: UNIVERSIDADE FEDERAL DE MATO GROSSO UFMT P&#xFA;blica Federal
## CO_MUNICIPIO_IES NO_MUNICIPIO_IES CO_UF_IES SGL_UF_IES NO_REGIAO_IES
## 1: 5103403 Cuiab&#xE1; 51 MT Centro-Oeste
## 2: 5103403 Cuiab&#xE1; 51 MT Centro-Oeste
## 3: 5103403 Cuiab&#xE1; 51 MT Centro-Oeste
## 4: 5103403 Cuiab&#xE1; 51 MT Centro-Oeste
## 5: 5103403 Cuiab&#xE1; 51 MT Centro-Oeste
## 6: 5103403 Cuiab&#xE1; 51 MT Centro-Oeste
## municipioNascimento ufNascimento municipioIES capitalIES
## 1: V&#xE1;rzea Grande (MT) MT Cuiab&#xE1; (MT) 1
## 2: Cuiab&#xE1; (MT) MT Cuiab&#xE1; (MT) 1
## 3: Cuiab&#xE1; (MT) MT Cuiab&#xE1; (MT) 1
## 4: Cuiab&#xE1; (MT) MT Cuiab&#xE1; (MT) 1
## 5: Cuiab&#xE1; (MT) MT Cuiab&#xE1; (MT) 1
## 6: Cuiab&#xE1; (MT) MT Cuiab&#xE1; (MT) 1
## municipio_diferente uf_diferente
## 1: 1 0
## 2: 0 0
## 3: 0 0
## 4: 0 0
## 5: 0 0
## 6: 0 0</code></pre>
</figure>
<p>
Com o <code class="highlighter-rouge">data.table</code>, o R levou menos
de 3 segundos para carregar o arquivo. Já deu para ver que o objeto
carregado tem quase 11 milhões de linhas e alguns valores nulos nas
colunas referente à UF e ao município de nascimento.
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># Percentual de alunos com informa&#xE7;&#xE3;o de UF de nascimento inv&#xE1;lida</span><span class="w">
</span><span class="m">100</span><span class="o">*</span><span class="nf">sum</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">CO_UF_NASCIMENTO</span><span class="p">))</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## [1] 0</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># filtrar fora alunos sem informa&#xE7;&#xE3;o de UF</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">CO_UF_NASCIMENTO</span><span class="p">)]</span></code></pre>
</figure>
<h2 id="manipulação-dos-dados">
Manipulação dos dados
</h2>
<p>
Outro arquivo presente nos microdados é o
<code class="highlighter-rouge">DM\_IES.csv</code>, que traz informações
sobre as Instituições de Ensino Superior no Brasil. Para este post, ele
será usado como uma tabela suporte ao arquivo principal, que obterá dele
informações sobre as IES de cada aluno, como o nome, o estado onde está
localizada, o tipo da universidade, etc.
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="n">df_ies</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fread</span><span class="p">(</span><span class="s2">&quot;DM_IES.CSV&quot;</span><span class="p">)</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Error in fread(&quot;DM_IES.CSV&quot;): File &apos;DM_IES.CSV&apos; does not exist. Include one or more spaces to consider the input a system command.</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># Vendo se funcionou:</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">df_ies</span><span class="p">)</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Error in eval(expr, envir, enclos): object &apos;df_ies&apos; not found</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># Imprimindo alguns nomes de universidades:</span><span class="w">
</span><span class="n">df_ies</span><span class="o">$</span><span class="n">NO_IES</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Error in eval(expr, envir, enclos): object &apos;df_ies&apos; not found</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># Temos que consertar o encoding do arquivo. Para isso, usamos a fun&#xE7;&#xE3;o iconv</span><span class="w">
</span><span class="n">df_ies</span><span class="o">$</span><span class="n">NO_IES</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">iconv</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ISO-8859-2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Error in eval(expr, envir, enclos): object &apos;df_ies&apos; not found</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># Testando para ver se funcionou:</span><span class="w">
</span><span class="n">df_ies</span><span class="o">$</span><span class="n">NO_IES</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Error in eval(expr, envir, enclos): object &apos;df_ies&apos; not found</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># Funcionou! Vamos ent&#xE3;o fazer o mesmo para outras colunas de texto</span><span class="w">
</span><span class="n">df_ies</span><span class="o">$</span><span class="n">SGL_IES</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">iconv</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ISO-8859-2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Error in eval(expr, envir, enclos): object &apos;df_ies&apos; not found</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="n">df_ies</span><span class="o">$</span><span class="n">DS_CATEGORIA_ADMINISTRATIVA</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">iconv</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ISO-8859-2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Error in eval(expr, envir, enclos): object &apos;df_ies&apos; not found</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="n">df_ies</span><span class="o">$</span><span class="n">NO_MUNICIPIO_IES</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">iconv</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ISO-8859-2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span><span class="w"> </span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Error in eval(expr, envir, enclos): object &apos;df_ies&apos; not found</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># Selecionando apenas colunas &#xFA;teis para esta an&#xE1;lise</span><span class="w">
</span><span class="n">df_ies</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">CO_IES</span><span class="p">,</span><span class="w"> </span><span class="n">NO_IES</span><span class="p">,</span><span class="w"> </span><span class="n">SGL_IES</span><span class="p">,</span><span class="w"> </span><span class="n">DS_CATEGORIA_ADMINISTRATIVA</span><span class="p">,</span><span class="w"> </span><span class="n">CO_MUNICIPIO_IES</span><span class="p">,</span><span class="w"> </span><span class="n">NO_MUNICIPIO_IES</span><span class="p">,</span><span class="w"> </span><span class="n">CO_UF_IES</span><span class="p">,</span><span class="w"> </span><span class="n">SGL_UF_IES</span><span class="p">,</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">)</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Error in eval(expr, envir, enclos): object &apos;df_ies&apos; not found</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># juntando todos os arquivos em um s&#xF3;:</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">left_join</span><span class="p">(</span><span class="n">df_ies</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;CO_IES&quot;</span><span class="p">)</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Error in is.data.frame(y): object &apos;df_ies&apos; not found</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="n">rm</span><span class="p">(</span><span class="n">df_ies</span><span class="p">)</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Warning in rm(df_ies): object &apos;df_ies&apos; not found</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># Certificar que o df ser&#xE1; tratado como data.table:</span><span class="w">
</span><span class="n">setDT</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="c1"># Nosso df ficou assim:</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Classes &apos;data.table&apos; and &apos;data.frame&apos;:   8041338 obs. of 18 variables:
## $ CO_IES : int 1 1 1 1 1 1 1 1 1 1 ...
## $ CO_UF_NASCIMENTO : int 51 51 51 51 51 51 51 51 51 51 ...
## $ CO_MUNICIPIO_NASCIMENTO : int 5108402 5103403 5103403 5103403 5103403 5103403 5103403 5103403 5103403 5103403 ...
## $ ANO_INGRESSO : int 2012 2012 2012 2014 2011 2011 2010 2010 2011 2010 ...
## $ NO_IES : chr &quot;UNIVERSIDADE FEDERAL DE MATO GROSSO&quot; &quot;UNIVERSIDADE FEDERAL DE MATO GROSSO&quot; &quot;UNIVERSIDADE FEDERAL DE MATO GROSSO&quot; &quot;UNIVERSIDADE FEDERAL DE MATO GROSSO&quot; ...
## $ SGL_IES : chr &quot;UFMT&quot; &quot;UFMT&quot; &quot;UFMT&quot; &quot;UFMT&quot; ...
## $ DS_CATEGORIA_ADMINISTRATIVA: chr &quot;P&#xFA;blica Federal&quot; &quot;P&#xFA;blica Federal&quot; &quot;P&#xFA;blica Federal&quot; &quot;P&#xFA;blica Federal&quot; ...
## $ CO_MUNICIPIO_IES : int 5103403 5103403 5103403 5103403 5103403 5103403 5103403 5103403 5103403 5103403 ...
## $ NO_MUNICIPIO_IES : chr &quot;Cuiab&#xE1;&quot; &quot;Cuiab&#xE1;&quot; &quot;Cuiab&#xE1;&quot; &quot;Cuiab&#xE1;&quot; ...
## $ CO_UF_IES : int 51 51 51 51 51 51 51 51 51 51 ...
## $ SGL_UF_IES : chr &quot;MT&quot; &quot;MT&quot; &quot;MT&quot; &quot;MT&quot; ...
## $ NO_REGIAO_IES : chr &quot;Centro-Oeste&quot; &quot;Centro-Oeste&quot; &quot;Centro-Oeste&quot; &quot;Centro-Oeste&quot; ...
## $ municipioNascimento : chr &quot;V&#xE1;rzea Grande (MT)&quot; &quot;Cuiab&#xE1; (MT)&quot; &quot;Cuiab&#xE1; (MT)&quot; &quot;Cuiab&#xE1; (MT)&quot; ...
## $ ufNascimento : chr &quot;MT&quot; &quot;MT&quot; &quot;MT&quot; &quot;MT&quot; ...
## $ municipioIES : chr &quot;Cuiab&#xE1; (MT)&quot; &quot;Cuiab&#xE1; (MT)&quot; &quot;Cuiab&#xE1; (MT)&quot; &quot;Cuiab&#xE1; (MT)&quot; ...
## $ capitalIES : num 1 1 1 1 1 1 1 1 1 1 ...
## $ municipio_diferente : num 1 0 0 0 0 0 0 0 0 0 ...
## $ uf_diferente : num 0 0 0 0 0 0 0 0 0 0 ...
## - attr(*, &quot;sorted&quot;)= chr &quot;CO_IES&quot;
## - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># Acrescentar nome do municipio de nascimento</span><span class="w">
</span><span class="c1"># importar c&#xF3;digos dos munic&#xED;pios brasileiros (tirado do site do IBGE)</span><span class="w">
</span><span class="n">df_cidades</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fread</span><span class="p">(</span><span class="s2">&quot;municipiosBR.csv&quot;</span><span class="p">)</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## Error in fread(&quot;municipiosBR.csv&quot;): File &apos;municipiosBR.csv&apos; does not exist. Include one or more spaces to consider the input a system command.</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="nf">names</span><span class="p">(</span><span class="n">df_cidades</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">&quot;uf&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;codigo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;nomemunicipio&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1"># Acrescentar coluna no df original:</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[,</span><span class="w"> </span><span class="n">municipioNascimento</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">df_cidades</span><span class="o">$</span><span class="n">nomemunicipio</span><span class="p">[</span><span class="n">match</span><span class="p">(</span><span class="n">CO_MUNICIPIO_NASCIMENTO</span><span class="p">,</span><span class="w"> </span><span class="n">df_cidades</span><span class="o">$</span><span class="n">codigo</span><span class="p">)]]</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[,</span><span class="w"> </span><span class="n">ufNascimento</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">df_cidades</span><span class="o">$</span><span class="n">uf</span><span class="p">[</span><span class="n">match</span><span class="p">(</span><span class="n">CO_MUNICIPIO_NASCIMENTO</span><span class="p">,</span><span class="w"> </span><span class="n">df_cidades</span><span class="o">$</span><span class="n">codigo</span><span class="p">)]]</span><span class="w">
</span><span class="c1"># Acrescentar UF no nome da cidade</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[,</span><span class="w"> </span><span class="n">municipioIES</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">NO_MUNICIPIO_IES</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot; (&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SGL_UF_IES</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;)&quot;</span><span class="p">)]</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[,</span><span class="w"> </span><span class="n">municipioNascimento</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">municipioNascimento</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot; (&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ufNascimento</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;)&quot;</span><span class="p">)]</span><span class="w"> </span><span class="c1"># Adicionar coluna que identifica se cidade &#xE9; capital</span><span class="w">
</span><span class="n">capitaisBR</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">&quot;RIO BRANCO&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MACEIO&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MACAPA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MANAUS&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SALVADOR&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FORTALEZA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;BRAS&#xCD;LIA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;VITORIA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;GOIANIA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SAO LUIS&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CUIABA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CAMPO GRANDE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;BELO HORIZONTE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;BEL&#xC9;M&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;JOAO PESSOA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CURITIBA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;RECIFE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TERESINA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;RIO DE JANEIRO&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NATAL&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PORTO ALEGRE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PORTO VELHO&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;BOA VISTA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;FLORIANOPOLIS&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SAO PAULO&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ARACAJU&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PALMAS&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">removeracentos</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">iconv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ASCII//TRANSLIT&quot;</span><span class="p">)</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[,</span><span class="w"> </span><span class="n">capitalIES</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">removeracentos</span><span class="p">(</span><span class="n">str_to_upper</span><span class="p">(</span><span class="n">NO_MUNICIPIO_IES</span><span class="p">))</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">capitaisBR</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)]</span></code></pre>
</figure>
<h2 id="apresentação-de-dados">
Apresentação de dados
</h2>
<p>
Agora já é possível fazer diversas análises possíveis. Vamos então
responder a algumas perguntas.
</p>
<h2 id="quantos-universitários-estudam-foram-de-suas-cidades-e-de-seus-estados-de-nascimento">
Quantos universitários estudam foram de suas cidades e de seus estados
de nascimento?
</h2>
<figure class="highlight">
<pre><code class="language-r"><span class="n">media</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="m">100</span><span class="o">*</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[,</span><span class="w"> </span><span class="n">municipio_diferente</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">CO_MUNICIPIO_IES</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">CO_MUNICIPIO_NASCIMENTO</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)]</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[,</span><span class="w"> </span><span class="n">uf_diferente</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">CO_UF_IES</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">CO_UF_NASCIMENTO</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)]</span><span class="w"> </span><span class="n">media</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">municipio_diferente</span><span class="p">)</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## [1] 57.38</code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="n">media</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">uf_diferente</span><span class="p">)</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-text">## [1] 22.83</code></pre>
</figure>
<p>
57,38% dos alunos estudam em uma cidade diferente da que nasceram e
22,83% em um estado diferente.
</p>
<p>
A distribuição desse índice por cidade e por IES pode ser observada
nestes gráficos:
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="n">temp1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tbl_df</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># necess&#xE1;rio para converter data.table em tbl_df, o formato do dplyr</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">CO_MUNICIPIO_IES</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">summarise</span><span class="p">(</span><span class="n">porc_cidade_dif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">media</span><span class="p">(</span><span class="n">municipio_diferente</span><span class="p">),</span><span class="w"> </span><span class="n">porc_uf_dif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">media</span><span class="p">(</span><span class="n">uf_diferente</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">gather</span><span class="p">(</span><span class="n">referencia</span><span class="p">,</span><span class="w"> </span><span class="n">valor</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">referencia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">referencia</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">&quot;Alunos de outra cidade&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Alunos de outro estado&quot;</span><span class="p">)),</span><span class="w"> </span><span class="n">estratificacao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Estratifica&#xE7;&#xE3;o por cidade&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="m">-1</span><span class="p">)</span><span class="w"> </span><span class="n">temp2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tbl_df</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># necess&#xE1;rio para converter data.table em tbl_df, o formato do dplyr</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">CO_IES</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">summarise</span><span class="p">(</span><span class="n">porc_cidade_dif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">media</span><span class="p">(</span><span class="n">municipio_diferente</span><span class="p">),</span><span class="w"> </span><span class="n">porc_uf_dif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">media</span><span class="p">(</span><span class="n">uf_diferente</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">gather</span><span class="p">(</span><span class="n">referencia</span><span class="p">,</span><span class="w"> </span><span class="n">valor</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">referencia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">referencia</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">&quot;Alunos de outra cidade&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Alunos de outro estado&quot;</span><span class="p">)),</span><span class="w"> </span><span class="n">estratificacao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Estratifica&#xE7;&#xE3;o por IES&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="m">-1</span><span class="p">)</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">temp2</span><span class="p">)</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">valor</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">binwidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;#1A476F&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;black&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_wrap</span><span class="p">(</span><span class="n">estratificacao</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">referencia</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;free_y&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;%&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Frequ&#xEA;ncia&quot;</span><span class="p">)</span></code></pre>
</figure>
<p>
<img src="http://sillasgonzaga.github.io/figs/censo_educ_superior1/unnamed-chunk-6-1.png" alt="center">
</p>
<p>
A diferença da distribuição de alunos de outra cidade quando se agrega
os resultados por cidade ou por IES é curiosa, a ponto de eu não
conseguir formular uma explicação para ela.
</p>
<h2 id="quais-são-as-cidades-que-mais-atraem-universitários-de-outros-municípios-e-estados">
Quais são as cidades que mais atraem universitários de outros municípios
e estados?
</h2>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># Definir um vetor de cores para cada regi&#xE3;o geogr&#xE1;fica, </span><span class="w">
</span><span class="c1"># cada uma ter&#xE1; uma cor fixa, baseada no palette wsj() do pacote ggthemes()</span><span class="w">
</span><span class="n">cores</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">&quot;Centro-Oeste&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&apos;#c72e29&apos;</span><span class="p">,</span><span class="w"> </span><span class="s1">&apos;Nordeste&apos;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&apos;#016392&apos;</span><span class="p">,</span><span class="w"> </span><span class="s1">&apos;Norte&apos;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&apos;#be9c2e&apos;</span><span class="p">,</span><span class="w"> </span><span class="s1">&apos;Sudeste&apos;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&apos;#098154&apos;</span><span class="p">,</span><span class="w"> </span><span class="s1">&apos;Sul&apos;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&apos;#fb832d&apos;</span><span class="p">)</span><span class="w"> </span><span class="c1">#p1 = percentual de aluno de outros municipios</span><span class="w">
</span><span class="n">p</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tbl_df</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">municipioIES</span><span class="p">,</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">summarise</span><span class="p">(</span><span class="n">porc_municipio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">media</span><span class="p">(</span><span class="n">municipio_diferente</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">top_n</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">porc_municipio</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reorder</span><span class="p">(</span><span class="n">municipioIES</span><span class="p">,</span><span class="w"> </span><span class="n">porc_municipio</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">porc_municipio</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;identity&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cores</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cidades com maior porcentual \nde universit&#xE1;rios de cidades diferentes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Regi&#xE3;o&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1"># p2: percentual de aluno de outros estados</span><span class="w">
</span><span class="n">p</span><span class="m">2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tbl_df</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">municipioIES</span><span class="p">,</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">summarise</span><span class="p">(</span><span class="n">porc_uf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">media</span><span class="p">(</span><span class="n">uf_diferente</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">top_n</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">porc_uf</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reorder</span><span class="p">(</span><span class="n">municipioIES</span><span class="p">,</span><span class="w"> </span><span class="n">porc_uf</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">porc_uf</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;identity&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cores</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cidades com maior porcentual \nde universit&#xE1;rios de estados diferentes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Regi&#xE3;o&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w"> </span><span class="c1"># p1 com apenas capitais</span><span class="w">
</span><span class="n">p</span><span class="m">3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tbl_df</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">capitalIES</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">municipioIES</span><span class="p">,</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">summarise</span><span class="p">(</span><span class="n">porc_municipio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">media</span><span class="p">(</span><span class="n">municipio_diferente</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">top_n</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">porc_municipio</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reorder</span><span class="p">(</span><span class="n">municipioIES</span><span class="p">,</span><span class="w"> </span><span class="n">porc_municipio</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">porc_municipio</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;identity&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cores</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Capitais com maior porcentual \nde universit&#xE1;rios de cidades diferentes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Regi&#xE3;o&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1"># p2 com apenas capitais</span><span class="w">
</span><span class="n">p</span><span class="m">4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tbl_df</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">capitalIES</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">municipioIES</span><span class="p">,</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">summarise</span><span class="p">(</span><span class="n">porc_uf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">media</span><span class="p">(</span><span class="n">uf_diferente</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">top_n</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">porc_uf</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reorder</span><span class="p">(</span><span class="n">municipioIES</span><span class="p">,</span><span class="w"> </span><span class="n">porc_uf</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">porc_uf</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;identity&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cores</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Capitais com maior porcentual \nde universit&#xE1;rios de estados diferentes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Regi&#xE3;o&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span></code></pre>
</figure>
<p>
Para isso, uma novidade aqui no blog: será usado o pacote
<code class="highlighter-rouge">cowplot</code> para juntar quatro
diferentes gráficos em uma imagem só.
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># juntar quatro gr&#xE1;ficos em um s&#xF3;</span><span class="w">
</span><span class="c1"># Retira a legenda dos gr&#xE1;ficos (para n&#xE3;o ficar redundante) e </span><span class="w">
</span><span class="c1"># reduz a margem da direita e da esquerda para reduzir o espa&#xE7;o vazio</span><span class="w">
</span><span class="n">p</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p</span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plot.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;pt&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">))</span><span class="w">
</span><span class="n">p</span><span class="m">2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plot.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;pt&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">))</span><span class="w">
</span><span class="n">p</span><span class="m">3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p</span><span class="m">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plot.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;pt&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">))</span><span class="w">
</span><span class="n">p</span><span class="m">4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p</span><span class="m">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plot.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;pt&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">))</span><span class="w"> </span><span class="n">prow</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plot_grid</span><span class="p">(</span><span class="n">p</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">align</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;vh&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1"># plotar legenda embaixo dos 4 gr&#xE1;ficos</span><span class="w">
</span><span class="n">grobs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplotGrob</span><span class="p">(</span><span class="n">p</span><span class="m">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">))</span><span class="o">$</span><span class="n">grobs</span><span class="w">
</span><span class="n">legend_b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grobs</span><span class="p">[[</span><span class="n">which</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">grobs</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;guide-box&quot;</span><span class="p">)]]</span><span class="w">
</span><span class="c1"># adicionar anota&#xE7;&#xE3;o:</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">add_sub</span><span class="p">(</span><span class="n">prow</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Em % dos universit&#xE1;rios da cidade&quot;</span><span class="p">)</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plot_grid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">legend_b</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">rel_heights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">.2</span><span class="p">))</span><span class="w">
</span><span class="n">ggdraw</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></code></pre>
</figure>
<p>
<img src="http://sillasgonzaga.github.io/figs/censo_educ_superior1/unnamed-chunk-8-1.png" alt="center">
</p>
<p>
Ou seja: para as 10 cidades com o maior porcentual de alunos de fora do
município, esse valor é de 100%. O histograma dessa distribuição mostra
que esse resultado não é surpreendente, pois existem mais de 20 cidades
que têm no mínimo 95% de alunos de outra cidade. Já quando se trata de
analisar as cidades que mais atraem universitários de outros estados,
quatro cidades goianas e três paranaenses despontam como capitais
universitárias. Surpreendentemente (ao menos para mim), apenas uma
cidade do Sudeste consta nesse Top 10. Dentre as capitais, Palmas e
Campo Grande se destacam como pólos universitários.
</p>
<p>
Possivelmente, o resultado será diferente se considerarmos, ao invés da
quantidade relativa, o número absoluto de universitários, que é o que é
feito abaixo:
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="c1">#p1 = percentual de aluno de outros municipios</span><span class="w">
</span><span class="n">p</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tbl_df</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">municipioIES</span><span class="p">,</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">summarise</span><span class="p">(</span><span class="n">porc_municipio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">municipio_diferente</span><span class="p">)</span><span class="o">/</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">top_n</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">porc_municipio</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reorder</span><span class="p">(</span><span class="n">municipioIES</span><span class="p">,</span><span class="w"> </span><span class="n">porc_municipio</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">porc_municipio</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;identity&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cores</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comma</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cidades com maior n&#xFA;mero\nde universit&#xE1;rios de cidades diferentes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Regi&#xE3;o&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1"># p2: percentual de aluno de outros estados</span><span class="w">
</span><span class="n">p</span><span class="m">2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tbl_df</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">municipioIES</span><span class="p">,</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">summarise</span><span class="p">(</span><span class="n">porc_uf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">uf_diferente</span><span class="p">)</span><span class="o">/</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">top_n</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">porc_uf</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reorder</span><span class="p">(</span><span class="n">municipioIES</span><span class="p">,</span><span class="w"> </span><span class="n">porc_uf</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">porc_uf</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;identity&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cores</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cidades com maior n&#xFA;mero\nde universit&#xE1;rios de estados diferentes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Regi&#xE3;o&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w"> </span><span class="c1"># p1 com apenas capitais</span><span class="w">
</span><span class="n">p</span><span class="m">3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tbl_df</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">capitalIES</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">municipioIES</span><span class="p">,</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">summarise</span><span class="p">(</span><span class="n">porc_municipio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">municipio_diferente</span><span class="p">)</span><span class="o">/</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">top_n</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">porc_municipio</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reorder</span><span class="p">(</span><span class="n">municipioIES</span><span class="p">,</span><span class="w"> </span><span class="n">porc_municipio</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">porc_municipio</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;identity&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cores</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Capitais com maior n&#xFA;mero\nde universit&#xE1;rios de cidades diferentes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Regi&#xE3;o&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1"># p2 com apenas capitais</span><span class="w">
</span><span class="n">p</span><span class="m">4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tbl_df</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">capitalIES</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">municipioIES</span><span class="p">,</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">summarise</span><span class="p">(</span><span class="n">porc_uf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">uf_diferente</span><span class="p">)</span><span class="o">/</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">top_n</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">porc_uf</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reorder</span><span class="p">(</span><span class="n">municipioIES</span><span class="p">,</span><span class="w"> </span><span class="n">porc_uf</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">porc_uf</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;identity&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cores</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Capitais com maior n&#xFA;mero\nde universit&#xE1;rios de estados diferentes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Regi&#xE3;o&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span></code></pre>
</figure>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># acrescentar quatro gr&#xE1;ficos em um s&#xF3;</span><span class="w">
</span><span class="n">p</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p</span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plot.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;pt&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">))</span><span class="w">
</span><span class="n">p</span><span class="m">2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plot.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;pt&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">))</span><span class="w">
</span><span class="n">p</span><span class="m">3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p</span><span class="m">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plot.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;pt&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">))</span><span class="w">
</span><span class="n">p</span><span class="m">4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p</span><span class="m">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">plot.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;pt&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">))</span><span class="w"> </span><span class="n">prow</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plot_grid</span><span class="p">(</span><span class="n">p</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">align</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;vh&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="n">grobs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplotGrob</span><span class="p">(</span><span class="n">p</span><span class="m">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">))</span><span class="o">$</span><span class="n">grobs</span><span class="w">
</span><span class="n">legend_b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grobs</span><span class="p">[[</span><span class="n">which</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">grobs</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;guide-box&quot;</span><span class="p">)]]</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">add_sub</span><span class="p">(</span><span class="n">prow</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Em milhares de universit&#xE1;rios&quot;</span><span class="p">)</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plot_grid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">legend_b</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">rel_heights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">.2</span><span class="p">))</span><span class="w">
</span><span class="n">ggdraw</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></code></pre>
</figure>
<p>
<img src="http://sillasgonzaga.github.io/figs/censo_educ_superior1/unnamed-chunk-10-1.png" alt="center">
</p>
<p>
Já que analisamos os resultados por cidade, podemos fazer o mesmo por
estado: quais UFs recebem mais estudantes de outros estados?
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">num_absoluto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">uf_diferente</span><span class="p">)</span><span class="o">/</span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">porcentual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">media</span><span class="p">(</span><span class="n">uf_diferente</span><span class="p">)),</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="p">(</span><span class="n">SGL_UF_IES</span><span class="p">,</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">)]</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_absoluto</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">porcentual</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NO_REGIAO_IES</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SGL_UF_IES</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_text_repel</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comma</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cores</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Quantidade absoluta (milhares)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;% dos estudantes que s&#xE3;o de outro estado&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Quantidade absoluta e porcentual do total de universit&#xE1;rios de \noutros estados para cada UF&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Regi&#xE3;o&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;right&quot;</span><span class="p">)</span></code></pre>
</figure>
<p>
<img src="http://sillasgonzaga.github.io/figs/censo_educ_superior1/grafico%20uf-1.png" alt="center">
</p>
<p>
O estado do Paraná é disparado o campeão nesse quesito em ambos os
critérios, isto é, tanto por quantidade absoluta - cerca de 600.000
universitários de outras partes do Brasil estudam na Rússia brasileira -
como por porcentual - aquela quantidade corresponde a cerca de 55% do
total de estudantes matriculados em universidades paranaenses. Na outra
ponta do gráfico, a ponta inferior esquerda, a maioria dos estados são
da região Nordeste e Norte, com destaque negativo para Maranhão, Alagoas
e Bahia, três dos estados mais pobres do país. Arrisco dizer que, por
serem mais pobres que a média nacional, as universidades desses estados
não têm reputação suficiente para atrair universitários de outros
estados do Brasil.
</p>
<h2 id="conclusão">
Conclusão
</h2>
<p>
Este é o fim de mais um post. No próximo post, falarei sobre o efeito do
Enem no movimento migracional
</p>
<figure class="highlight">
<pre><code class="language-r"><span class="c1"># Salvar o arquivo para posteriores an&#xE1;lises:</span><span class="w">
</span><span class="n">write_feather</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dm_aluno_tratado.feather&quot;</span><span class="p">)</span></code></pre>
</figure>
</article>

