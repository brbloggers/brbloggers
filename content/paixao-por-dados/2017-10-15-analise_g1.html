<article class="blog-post"> <figure class="highlight"><pre><code class="language-r"><span class="n">library</span><span class="p">(</span><span class="n">rvest</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">Rfacebook</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidytext</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tm</span><span class="p">)</span></code></pre></figure> <p>Apesar de hoje em dia eu morar no Rio de Janeiro, morei e vivi (quase) a vida toda em Aracaju, a capital do menor estado do Brasil. Devido &#xE0; irrelev&#xE2;ncia que a cidade tem (desculpa mas &#xE9; verdade) no cen&#xE1;rio pol&#xED;tico e econ&#xF4;mico do pa&#xED;s, era (e ainda &#xE9;) muito raro ver qualquer not&#xED;cia em um ve&#xED;culo de audi&#xEA;ncia nacional (como o Jornal Nacional ou a homepage do G1 ou Estad&#xE3;o) relacionada a Aracaju ou a Sergipe que n&#xE3;o seja desgra&#xE7;a ou por um acontecimento inusitadamente ruim. Voltei a notar isso recentemente, quando saiu na homepage do G1 uma not&#xED;cia de Sergipe sobre o <a href="https://g1.globo.com/se/sergipe/noticia/camarote-desaba-durante-show-de-ivete-sangalo-em-aracaju.ghtml?utm_source=facebook&amp;utm_medium=social&amp;utm_campaign=g1">desabamento de um camarote durante a Odonto Fantasy</a>, uma das maiores festas a fantasia do Brasil.</p> <p>Como bom entusiasta por Data Science, decidi n&#xE3;o me ater ao senso comum de que Sergipe s&#xF3; tem destaque nacional por motivos de desgra&#xE7;a e sujei as m&#xE3;os: &#xE9; poss&#xED;vel testar a hip&#xF3;tese de que certos temas s&#xE3;o mais associados a algumas cidades que outras? O que destaca as not&#xED;cias sobre estados menores que saem na homepage do G1 comparadas com as de estados maiores?</p> <p>Consigo pensar em pelo menos dois (possivelmente existem mais) m&#xE9;todos para realizar essa an&#xE1;lise: al&#xE9;m da an&#xE1;lise de frequ&#xEA;ncia mencionada acima (a palavra X est&#xE1; mais associada a cidade Y1 do que a cidade Y2), poderia ser aplicada uma an&#xE1;lise de sentimento para distinguir o sentimento de not&#xED;cias relacionadas a Aracaju em compara&#xE7;&#xE3;o com o de cidades maiores. Neste post, o foco ser&#xE1; na primeira alternativa.</p> <h2 id="coleta-dos-dados">Coleta dos dados</h2> <p>Vejam que fui enf&#xE1;tico sobre a not&#xED;cia em si ter sa&#xED;do na homepage do G1 ou n&#xE3;o. Ou seja, n&#xE3;o basta ela ter sa&#xED;do na p&#xE1;gina local do estado (como a de <a href="http://g1.globo.com/se/">Sergipe</a>). O primeiro problema &#xE9; ent&#xE3;o ter um hist&#xF3;rico de not&#xED;cias que sa&#xED;ram na primeira p&#xE1;gina, o que n&#xE3;o existe em nenhum lugar p&#xFA;blico na Internet. N&#xE3;o bastaria entrar na p&#xE1;gina de cada estado e coletar as not&#xED;cias. Nesta an&#xE1;lise, &#xE9; fundamental ter a certeza de que pessoas de todo o Brasil puderam ter acesso f&#xE1;cil ao artigo.</p> <p>Para resolver o problema, utilizei o pressuposto de que, se a not&#xED;cia foi postada na <a href="https://www.facebook.com/g1">p&#xE1;gina do G1 no Facebook</a>, &#xE9; porque ela saiu na home. N&#xE3;o sei o quanto que isso &#xE9; verdade, mas acredito que seja uma hip&#xF3;tese v&#xE1;lida.</p> <p>Para extrair os links postados na p&#xE1;gina do G1 no Facebook, utilizamos o pacote <code class="highlighter-rouge">Rfacebook</code>:</p> <figure class="highlight"><pre><code class="language-r"><span class="n">token</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readRDS</span><span class="p">(</span><span class="s2">&quot;/home/sillas/R/facebook_token.Rds&quot;</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Rfacebook</span><span class="o">::</span><span class="n">getPage</span><span class="p">(</span><span class="s2">&quot;180562885329138&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5000</span><span class="p">)</span></code></pre></figure> <p>O intervalo pesquisado &#xE9;:</p> <figure class="highlight"><pre><code class="language-r"><span class="nf">range</span><span class="p">(</span><span class="n">sort</span><span class="p">(</span><span class="n">g</span><span class="m">1</span><span class="o">$</span><span class="n">created_time</span><span class="p">))</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text">## [1] &quot;2006-09-18T07:00:00+0000&quot; &quot;2017-10-14T20:46:01+0000&quot;</code></pre></figure> <figure class="highlight"><pre><code class="language-r"><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="m">1</span><span class="o">$</span><span class="n">link</span></code></pre></figure> <p>Nem todos os links postados pela p&#xE1;gina redirecionam ao G1: alguns s&#xE3;o de v&#xED;deos postados no pr&#xF3;prio Facebook. Por isso, &#xE9; necess&#xE1;rio limpar os dados:</p> <figure class="highlight"><pre><code class="language-r"><span class="c1"># remover links de videos do facebook
</span><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="p">[</span><span class="o">!</span><span class="n">str_detect</span><span class="p">(</span><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;www.facebook.com&quot;</span><span class="p">)]</span><span class="w"> </span><span class="c1"># ver links mais comuns
</span><span class="n">str_replace_all</span><span class="p">(</span><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;http://|https://&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">str_replace_all</span><span class="p">(</span><span class="s2">&quot;/.*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">table</span><span class="p">()</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text">## .
## bit.ly fantastico.globo.com g1.globo.com ## 8 1 717 ## glo.bo globoesporte.globo.com media.giphy.com ## 895 8 1 ## s2.glbimg.com ## 1</code></pre></figure> <p>Ainda existem alguns links meio nebulosos. Vamos nos ater aos que s&#xE3;o do G1 (<em>g1.globo.com</em>) e do encurtador de URLs da Globo.com (<em>glo.bo</em>). Para estes &#xFA;ltimos, como precisamos extrair o estado da not&#xED;cia da URL (de https://g1.globo.com/se/sergipe/noticia/camarote-desaba-durante-show-de-ivete-sangalo-em-aracaju.ghtml precisamos extrair <strong>&#x201C;se&#x201D;</strong>, a sigla de Sergipe), uso uma fun&#xE7;&#xE3;o postada no meu Gist para converter uma URL encurtada em normal:</p> <figure class="highlight"><pre><code class="language-r"><span class="c1"># manter apenas links glo.bo e g1.globo.com
</span><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="p">[</span><span class="n">str_detect</span><span class="p">(</span><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;g1.globo.com|glo.bo&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="p">)]</span><span class="w">
</span><span class="c1"># carregar funcao para transformar url encurtada
</span><span class="n">devtools</span><span class="o">::</span><span class="n">source_gist</span><span class="p">(</span><span class="s2">&quot;2e92f880811f460c7edd0a622563a17a&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;getLongURL.R&quot;</span><span class="p">)</span><span class="w">
</span><span class="c1"># converter links glo.bo para urls inteiras
</span><span class="n">ind</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">str_which</span><span class="p">(</span><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;glo.bo&quot;</span><span class="p">)</span><span class="w">
</span><span class="n">getLongURL.curl.possibly</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">possibly</span><span class="p">(</span><span class="n">getLongURL.curl</span><span class="p">,</span><span class="w"> </span><span class="n">otherwise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span><span class="w">
</span><span class="n">novos_links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">map_chr</span><span class="p">(</span><span class="n">getLongURL.curl.possibly</span><span class="p">)</span><span class="w">
</span><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">novos_links</span><span class="w">
</span><span class="c1"># manter apenas links glo.bo e g1.globo.com (para remover links de outros sites da globo, como o Globoesporte.com)
</span><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="p">[</span><span class="n">str_detect</span><span class="p">(</span><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;g1.globo.com|glo.bo&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="p">)]</span></code></pre></figure> <p>Tendo os links corrigidos, podemos ent&#xE3;o criar uma fun&#xE7;&#xE3;o que extraia o corpo da not&#xED;cia do link. Como o foco deste post n&#xE3;o &#xE9; o Web Scraping em si e sim os dados resultantes dele, n&#xE3;o vou descrever muito o que a fun&#xE7;&#xE3;o abaixo faz. Em caso de d&#xFA;vidas, escreva nos coment&#xE1;rios do post ou entre em contato comigo que eu responderei com grande prazer.</p> <figure class="highlight"><pre><code class="language-r"><span class="c1"># criar fun&#xE7;&#xE3;o
</span><span class="n">extrair_g1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">url_g1</span><span class="p">){</span><span class="w"> </span><span class="c1"># exemplo de url:
</span><span class="w"> </span><span class="c1"># &quot;https://g1.globo.com/rio-de-janeiro/noticia/imagens-mostram-acao-de-criminosos-durante-assalto-na-zona-norte-do-rio.ghtml&quot;
</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">str_detect</span><span class="p">(</span><span class="n">url_g1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;glo.bo&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">str_detect</span><span class="p">(</span><span class="n">url_g1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;g1.globo&quot;</span><span class="p">)){</span><span class="w"> </span><span class="n">warning</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">&quot;Link inv&#xE1;lido: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">url_g1</span><span class="p">))</span><span class="w"> </span><span class="nf">return</span><span class="p">(</span><span class="kc">NA</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">url_g1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">read_html</span><span class="p">()</span><span class="w"> </span><span class="c1"># extrair sessao da noticia
</span><span class="w"> </span><span class="n">css_nome_caderno</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">&quot;.header-editoria--link&quot;</span><span class="w"> </span><span class="n">caderno</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_nodes</span><span class="p">(</span><span class="n">css_nome_caderno</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_text</span><span class="p">()</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">caderno</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="n">caderno</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w"> </span><span class="c1"># extrair corpo da noticia
</span><span class="w"> </span><span class="n">css_corpo_a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">&quot;.content-text__container&quot;</span><span class="w"> </span><span class="n">css_corpo_b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">&quot;#materia-letra p&quot;</span><span class="w"> </span><span class="n">css_corpo_c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">&quot;.post-content p&quot;</span><span class="w"> </span><span class="n">corpo_noticia</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_nodes</span><span class="p">(</span><span class="n">css_corpo_a</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_text</span><span class="p">()</span><span class="w"> </span><span class="c1"># se o css selector nao funcionou, use outro:
</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">corpo_noticia</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">corpo_noticia</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_nodes</span><span class="p">(</span><span class="n">css_corpo_b</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_text</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">corpo_noticia</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">corpo_noticia</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_nodes</span><span class="p">(</span><span class="n">css_corpo_c</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_text</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1"># colapsar corpo da noticia em um vetor de elemento unico
</span><span class="w"> </span><span class="n">corpo_noticia</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">corpo_noticia</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;. &quot;</span><span class="p">)</span><span class="w"> </span><span class="n">tibble</span><span class="p">(</span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url_g1</span><span class="p">,</span><span class="w"> </span><span class="n">caderno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">caderno</span><span class="p">,</span><span class="w"> </span><span class="n">corpo_noticia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">corpo_noticia</span><span class="p">)</span><span class="w">
</span><span class="p">}</span></code></pre></figure> <figure class="highlight"><pre><code class="language-r"><span class="c1"># agora sim extrair dados do g1:
</span><span class="n">df_g1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g</span><span class="m">1</span><span class="err">_</span><span class="n">links</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">map_df</span><span class="p">(</span><span class="n">extrair_g1</span><span class="p">)</span></code></pre></figure> <figure class="highlight"><pre><code class="language-r"><span class="c1"># extrair caderno da url da noticia
</span><span class="n">df_g1</span><span class="o">$</span><span class="n">documento</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_g1</span><span class="o">$</span><span class="n">url</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">str_replace_all</span><span class="p">(</span><span class="s2">&quot;https&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;http&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">str_replace_all</span><span class="p">(</span><span class="s2">&quot;http://g1.globo.com/&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">str_replace_all</span><span class="p">(</span><span class="s2">&quot;/.*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span></code></pre></figure> <p>Uma amostra m&#xED;nima dos dados coletados:</p> <figure class="highlight"><pre><code class="language-r"><span class="n">str</span><span class="p">(</span><span class="n">df_g1</span><span class="p">[</span><span class="m">1</span><span class="p">,])</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text">## Classes &apos;tbl_df&apos;, &apos;tbl&apos; and &apos;data.frame&apos;:	1 obs. of 4 variables:
## $ url : chr &quot;https://g1.globo.com/politica/operacao-lava-jato/noticia/occhi-tinha-meta-mensal-de-propina-para-distribuir-a-p&quot;| __truncated__
## $ caderno : chr &quot;Opera&#xE7;&#xE3;o Lava Jato&quot;
## $ corpo_noticia: chr &quot; O doleiro L&#xFA;cio Funaro afirmou em seu acordo de dela&#xE7;&#xE3;o premiada com a Procuradoria Geral da Rep&#xFA;blica (PGR) q&quot;| __truncated__
## $ documento : chr &quot;politica&quot;</code></pre></figure> <p>Agora podemos partir para a an&#xE1;lise. Mas antes, um pouco de contexto te&#xF3;rico:</p> <h2 id="tf-idf">tf-idf</h2> <p>O <strong>Fator de Frequ&#xEA;ncia Inversa no Documento</strong> ou <em>term&#x2019;s inverse document frequency</em> (tf-idf) &#xE9; uma t&#xE9;cnica de minera&#xE7;&#xE3;o de texto que calcula a
frequ&#xEA;ncia de um determinado elemento textual (como uma palavra ou um n-gram) em um documento, diminuindo o peso de palavras comumente usadas em v&#xE1;rios contextos diferentes (como &#x201C;a&#x201D;, &#x201C;o&#x201D; e &#x201C;de&#x201D;) e aumentando o peso de palavras que n&#xE3;o s&#xE3;o usadas em outros documentos da cole&#xE7;&#xE3;o.</p> <p>No gloss&#xE1;rio de minera&#xE7;&#xE3;o de texto, documento nada mais &#xE9; do que uma cole&#xE7;&#xE3;o que categoriza um conjunto de textos. Pode ser um livro (inteiro ou apenas um ou mais cap&#xED;tulos), a letra de uma m&#xFA;sica, um poema, uma not&#xED;cia, um conjunto de not&#xED;cias, etc. No nosso contexto, definimos como documento as not&#xED;cias do G1 coletadas nessa amostra sobre um determinado tema, como Rio de Janeiro, S&#xE3;o Paulo, Pol&#xED;tica ou Economia. Da&#xED; o nome da &#xFA;ltima coluna.</p> <p>O livro online <a href="http://tidytextmining.com/tfidf.html">Text Mining with R</a> &#xE9; uma &#xF3;tima refer&#xEA;ncia para tf-idf, tanto te&#xF3;rica quanto pr&#xE1;tica.</p> <h2 id="resultados">Resultados</h2> <p>Quais s&#xE3;o os documentos mais comuns?</p> <figure class="highlight"><pre><code class="language-r"><span class="n">df_g1</span><span class="o">$</span><span class="n">documento</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">table</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">sort</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">rev</span><span class="p">()</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text">## .
## mundo sao-paulo rio-de-janeiro ## 205 158 118 ## pop-arte tecnologia economia ## 110 102 99 ## politica sp ciencia-e-saude ## 95 73 60 ## planeta-bizarro bemestar musica ## 37 30 29 ## distrito-federal mg pr ## 28 27 26 ## carros vestibular-e-educacao goias ## 24 21 21 ## brasil educacao rock-in-rio ## 21 18 17 ## natureza espirito-santo sc ## 17 15 13 ## rs resumo-do-dia minas-gerais ## 13 13 13 ## mato-grosso 11-de-setembro bahia ## 13 13 12 ## vc-no-g1 parana agenda-do-dia ## 10 10 9 ## pi bienal-do-livro rj ## 8 8 7 ## swu pernambuco pb ## 6 6 6 ## mato-grosso-do-sul loterias rn ## 6 6 5 ## to rr ro ## 4 4 4 ## revolta-arabe paraiba pa ## 4 4 4 ## fantastico dia-das-criancas ac ## 4 4 4 ## turismo-e-viagem rihanna-no-brasil platb ## 3 3 3 ## justin-bieber-no-brasil e-ou-nao-e ceara ## 3 3 3 ## videos se ma ## 2 2 2 ## loteria ap am ## 2 2 2 ## al spfw reveillon-2012 ## 2 1 1 ## monitor-da-violencia especial-publicitario especiais ## 1 1 1 ## dia-dos-pais dia-dos-namorados concursos-e-emprego ## 1 1 1 ## amazonas ## 1</code></pre></figure> <p>As sess&#xF5;es do G1 que mais marcam presen&#xE7;a na homepage s&#xE3;o, sem muita surpresa, <a href="http://g1.globo.com/mundo/">Mundo</a>, <a href="http://g1.globo.com/sao-paulo/">S&#xE3;o Paulo</a> e <a href="http://g1.globo.com/rio-de-janeiro/">Rio de Janeiro</a>. Voc&#xEA; pode ter percebido que existe tanto um documento chamado &#x201C;sao-paulo&#x201D; como &#x201C;sp&#x201D;, assim como &#x201C;rio-de-janeiro&#x201D; e &#x201C;rj&#x201D;. Isso acontece porque o G1, para os maiores estados, tem sess&#xF5;es separadas para a capital e para o resto das cidades.</p> <p>Os dois primeiros objetos de estudo s&#xE3;o as cidades mais famosas do Brasil: Rio de Janeiro e S&#xE3;o Paulo. O passo-a-passo da aplica&#xE7;&#xE3;o do tf-idf para essas duas cidades &#xE9; descrito abaixo:</p> <figure class="highlight"><pre><code class="language-r"><span class="n">docs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">&quot;rio-de-janeiro&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;sao-paulo&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">df_filtro</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_g1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1">#mutate(caderno_url = if_else(caderno %in% vetor_cadernos, &quot;Selecionado&quot;, &quot;Outros&quot;))
</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">documento</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">docs</span><span class="p">)</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_filtro</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># separar cada palavra do corpo da not&#xED;cia em uma linha diferente, sem converter para minusculo
</span><span class="w"> </span><span class="n">unnest_tokens</span><span class="p">(</span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">corpo_noticia</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ngrams&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">to_lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># remover as duplicatas, isto &#xE9;, as palavras que aparecem mais de uma vez em uma mesma noticia
</span><span class="w"> </span><span class="n">distinct</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">.keep_all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># contar a ocorrencia de cada palavra em cada doc
</span><span class="w"> </span><span class="n">count</span><span class="p">(</span><span class="n">documento</span><span class="p">,</span><span class="w"> </span><span class="n">palavra</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tidytext</span><span class="o">::</span><span class="n">bind_tf_idf</span><span class="p">(</span><span class="n">term_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">document_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">documento</span><span class="p">,</span><span class="w"> </span><span class="n">n_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># ordenar as palavras com menor tf_idf por documento
</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">documento</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">tf_idf</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">palavra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">palavra</span><span class="p">))))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1">#filtrar as 20 de maior destaque
</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">row_number</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">20</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">tf_idf</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">palavra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">palavra</span><span class="p">))))</span><span class="w"> </span><span class="c1"># construir grafico
</span><span class="n">temp</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">tf_idf</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">documento</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_col</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tf-idf&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Termos mais frequentes associados a apenas uma das cidades&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Fonte: Minera&#xE7;&#xE3;o de texto aplicada em not&#xED;cias do G1.&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">documento</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;free&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span></code></pre></figure> <p><img src="http://sillasgonzaga.github.io/figs/analise_g1/unnamed-chunk-69-1.png" alt="center"></p> <p>Algumas observa&#xE7;&#xF5;es sobre os resultados precisam ser feitas:</p>
<ul> <li>No Rio de Janeiro, aparecem alguns termos meio estranhos como Envie e VC. Isso acontece porque, durante um per&#xED;odo, no final das reportagens, o G1 escrevia algo como &#x201C;Envie VC tamb&#xE9;m uma reportagem para o G1RJ pelo Whatsapp ou pelo Viber&#x201D;.</li> <li>Alguns nomes pr&#xF3;prios se destacam, o que &#xE9; natural, visto que D&#xF3;ria &#xE9; prefeito de SP e Cabral um ex-governador do RJ. Em minera&#xE7;&#xE3;o de texto, esse tipo de dado &#xE9; chamado de Entidade.</li>
</ul> <p>Para limpar os resultados no segundo caso, s&#xE3;o removidos os substantitos pr&#xF3;prios. A maneira que eu bolei para isso talvez n&#xE3;o seja a mais cient&#xED;fica ou linguisticamente correta poss&#xED;vel, mas aparenta ter funcionado. Ela se baseia em remover toda palavra que n&#xE3;o &#xE9; igual se escrita toda em min&#xFA;sculo ou se escrita toda em mai&#xFA;sculo. Por exemplo:</p> <figure class="highlight"><pre><code class="language-r"><span class="n">eh_substantivo_comum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">str_to_lower</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">str_to_upper</span><span class="p">(</span><span class="n">x</span><span class="p">)}</span><span class="w">
</span><span class="nf">c</span><span class="p">(</span><span class="n">eh_substantivo_comum</span><span class="p">(</span><span class="s2">&quot;tiroteio&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">eh_substantivo_comum</span><span class="p">(</span><span class="s2">&quot;RJTV&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">eh_substantivo_comum</span><span class="p">(</span><span class="s2">&quot;Doria&quot;</span><span class="p">))</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text">## [1] TRUE TRUE FALSE</code></pre></figure> <p>Aproveitando o embalo da limpeza de dados, os termos mencionados acima como &#x201C;Envie&#x201D; e &#x201C;VC&#x201D; tamb&#xE9;m ser&#xE3;o removidos. Aplicando esta metodologia:</p> <figure class="highlight"><pre><code class="language-r"><span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_filtro</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">unnest_tokens</span><span class="p">(</span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">corpo_noticia</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ngrams&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">to_lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># aplicar regra do substantivo comum
</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">eh_substantivo_comum</span><span class="p">(</span><span class="n">palavra</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># remover termos estranhos
</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">palavra</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">&quot;VC&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;RJTV&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">distinct</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">.keep_all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">count</span><span class="p">(</span><span class="n">documento</span><span class="p">,</span><span class="w"> </span><span class="n">palavra</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tidytext</span><span class="o">::</span><span class="n">bind_tf_idf</span><span class="p">(</span><span class="n">term_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">document_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">documento</span><span class="p">,</span><span class="w"> </span><span class="n">n_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">documento</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">tf_idf</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">palavra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">palavra</span><span class="p">))))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">row_number</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">20</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">tf_idf</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">palavra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">palavra</span><span class="p">))))</span><span class="w"> </span><span class="c1"># construir grafico
</span><span class="n">temp</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">tf_idf</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">documento</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_col</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tf-idf&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Termos mais frequentes associados a apenas uma das cidades&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Fonte: Minera&#xE7;&#xE3;o de texto aplicada em not&#xED;cias do G1.&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">documento</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;free&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span></code></pre></figure> <p><img src="http://sillasgonzaga.github.io/figs/analise_g1/unnamed-chunk-71-1.png" alt="center"></p> <p>Agora &#xE9; poss&#xED;vel notar resultados mais interessantes: termos relacionados ao tr&#xE1;fico de drogas como <strong>tiroteio</strong>, <strong>rival</strong>, <strong>UPP</strong> e <strong>propinas</strong> possui uma frequ&#xEA;ncia relativa muito maior em not&#xED;cias sobre a cidade do Rio de Janeiro que na capital paulista. Por outro lado, not&#xED;cias sobre <strong>estupro</strong> e <strong>abuso</strong> parecem ser mais comuns na terra onde biscoito &#xE9; chamado de bolacha.</p> <p>Tamb&#xE9;m &#xE9; poss&#xED;vel realizar essa mesma an&#xE1;lise por express&#xF5;es compostas por mais de uma palavra, que s&#xE3;o os chamados n-grams, onde n &#xE9; a quantidade de termos. Analisando os 2-grams:</p> <figure class="highlight"><pre><code class="language-r"><span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_filtro</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">unnest_tokens</span><span class="p">(</span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">corpo_noticia</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ngrams&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">to_lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># aplicar regra do substantivo comum
</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">eh_substantivo_comum</span><span class="p">(</span><span class="n">palavra</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">distinct</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">.keep_all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">count</span><span class="p">(</span><span class="n">documento</span><span class="p">,</span><span class="w"> </span><span class="n">palavra</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tidytext</span><span class="o">::</span><span class="n">bind_tf_idf</span><span class="p">(</span><span class="n">term_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">document_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">documento</span><span class="p">,</span><span class="w"> </span><span class="n">n_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">documento</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">tf_idf</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">palavra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">palavra</span><span class="p">))))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">row_number</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">20</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">tf_idf</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">palavra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">palavra</span><span class="p">))))</span><span class="w"> </span><span class="c1"># construir grafico
</span><span class="n">temp</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">palavra</span><span class="p">,</span><span class="w"> </span><span class="n">tf_idf</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">documento</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_col</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tf-idf&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">documento</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;free&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span></code></pre></figure> <p><img src="http://sillasgonzaga.github.io/figs/analise_g1/unnamed-chunk-72-1.png" alt="center"></p> <h2 id="e-sergipe">E Sergipe?</h2> <p>Conforme foi mostrado um pouco acima, existem apenas 2 not&#xED;cias de Sergipe na amostra coletada. O Sudeste &#xE9; o grande monopolizador da primeira p&#xE1;gina do G1. Mesmo se aplic&#xE1;ssemos o tf-idf comparando o Rio de Janeiro com Sergipe, os resultados seriam enviesados devido &#xE0; baix&#xED;ssima quantidade de dados do &#xFA;ltimo. Por isso, Norte e Nordeste s&#xE3;o agregadas como uma:</p> <p>Vamos ent&#xE3;o criar mais uma coluna para identificar a regi&#xE3;o do Brasil a qual a not&#xED;cia se refere:</p> <figure class="highlight"><pre><code class="language-r"><span class="n">df_g1</span><span class="w"> </span><span class="o">%&lt;&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">regiao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">case_when</span><span class="p">(</span><span class="w"> </span><span class="n">documento</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">&quot;ac&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;am&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;amazonas&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ap&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;pa&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ro&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rr&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">&quot;Norte&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">documento</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">(</span><span class="s2">&quot;al&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bahia&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ceara&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ma&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;paraiba&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;pb&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;pernambuco&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;pi&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;se&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;to&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">&quot;Nordeste&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">documento</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">&quot;distrito-federal&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;goias&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mato-grosso&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mato-grosso-do-sul&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">&quot;Centro-Oeste&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">documento</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">&quot;espirito&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mg&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;minas-gerais&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rio-de-janeiro&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rj&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;sao-paulo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;sp&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">&quot;Sudeste&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">documento</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">&quot;parana&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;sc&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">&quot;Sul&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">#caderno_url %in% &quot;mundo&quot; ~ &quot;Mundo&quot;,
</span><span class="w"> </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="kc">NA_character_</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="n">df_g1</span><span class="o">$</span><span class="n">regiao</span><span class="p">[</span><span class="n">df_g1</span><span class="o">$</span><span class="n">regiao</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">&quot;Norte&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Nordeste&quot;</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">&quot;Norte-Nordeste&quot;</span><span class="w"> </span><span class="c1"># regioes mais comuns:
</span><span class="n">df_g1</span><span class="o">$</span><span class="n">regiao</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">table</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">sort</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">rev</span><span class="p">()</span></code></pre></figure> <figure class="highlight"><pre><code class="language-text">## .
## Sudeste Norte-Nordeste Centro-Oeste Sul ## 396 75 68 36</code></pre></figure> <p>Para n&#xE3;o ter de repetir o c&#xF3;digo que constr&#xF3;i os gr&#xE1;ficos acima, salvei a fun&#xE7;&#xE3;o <a href="">neste Gist</a>, com direito a algumas parametriza&#xE7;&#xF5;es, como a op&#xE7;&#xE3;o de remover ou n&#xE3;o substantivos pr&#xF3;prios:</p> <figure class="highlight"><pre><code class="language-r"><span class="n">id_gist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">&quot;2d626f33ee1b635a0aa3beeda31ae720&quot;</span><span class="w">
</span><span class="n">devtools</span><span class="o">::</span><span class="n">source_gist</span><span class="p">(</span><span class="n">id_gist</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;grafico_g1.R&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">df_g1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">documento</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">regiao</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">documento</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">grafico_tfidf</span><span class="p">(</span><span class="n">n_grams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">remover_nomes_proprios</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">agregar_por_noticia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure> <p><img src="http://sillasgonzaga.github.io/figs/analise_g1/unnamed-chunk-74-1.png" alt="center"></p> <p>Mesmo agregando os dados por regi&#xE3;o, o desbalanceamento da quantidade de not&#xED;cias por regi&#xE3;o prejudicou os resultados. Seria necess&#xE1;rio coletar muito mais not&#xED;cias para que os resultados fossem mais interessantes.</p> <h2 id="b&#xF4;nus">B&#xF4;nus</h2> <p>A an&#xE1;lise n&#xE3;o precisa se restringir a regi&#xF5;es demogr&#xE1;ficas. Podemos, por exemplo, comparar not&#xED;cias dos cadernos de Pol&#xED;tica e Economia:</p> <figure class="highlight"><pre><code class="language-r"><span class="n">df_g1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">documento</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">&quot;politica&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;economia&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">grafico_tfidf</span><span class="p">(</span><span class="n">n_grams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">remover_nomes_proprios</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">agregar_por_noticia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure> <p><img src="http://sillasgonzaga.github.io/figs/analise_g1/unnamed-chunk-75-1.png" alt="center"></p> </article>
